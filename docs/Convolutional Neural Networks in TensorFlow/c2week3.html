<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tensorflowing - W3:Transfer learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../logo.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../logo.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Tensorflowing</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-intro" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Intro</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-intro">    
        <li class="dropdown-header">Intro</li>
        <li>
    <a class="dropdown-item" href="../intro/about.html">
 <span class="dropdown-text">About</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-deep-neural-networks" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Deep Neural Networks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-deep-neural-networks">    
        <li class="dropdown-header">DeepLearning</li>
        <li>
    <a class="dropdown-item" href="../DeepLearning/c1w1.html">
 <span class="dropdown-text">W1:A New Programming Paradigm</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../DeepLearning/c1w2.html">
 <span class="dropdown-text">W2:Introduction to Computer Vision</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../DeepLearning/c1w3.html">
 <span class="dropdown-text">W3:Enhancing Vision with Convolutional Neural Networks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../DeepLearning/c1w4.html">
 <span class="dropdown-text">W4:Using Real-world Images</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-convolutional-neural-networks" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Convolutional Neural Networks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-convolutional-neural-networks">    
        <li class="dropdown-header">Convolutional Neural Networks in TensorFlow</li>
        <li>
    <a class="dropdown-item" href="../Convolutional Neural Networks in TensorFlow/c2week1.html">
 <span class="dropdown-text">W1:Exploring a Larger Dataset</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Convolutional Neural Networks in TensorFlow/c2week2.html">
 <span class="dropdown-text">W2:Augmentation: A technique to avoid overfitting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Convolutional Neural Networks in TensorFlow/c2week3.html">
 <span class="dropdown-text">W3:Transfer learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Convolutional Neural Networks in TensorFlow/c2week4.html">
 <span class="dropdown-text">W4:multi-class classification</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-natural-language-processing" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Natural Language Processing</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-natural-language-processing">    
        <li class="dropdown-header">Natural Language Processing</li>
        <li>
    <a class="dropdown-item" href="../Natural Language Processing/c3week1.html">
 <span class="dropdown-text">W1:Sentiment in text</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Natural Language Processing/c3week2.html">
 <span class="dropdown-text">W2:Word Embeddings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Natural Language Processing/c3week3.html">
 <span class="dropdown-text">W3:Sequence models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Natural Language Processing/c3week4.html">
 <span class="dropdown-text">W4:Sequence models and literature</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-time-series" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Time Series</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-time-series">    
        <li class="dropdown-header">Time Series</li>
        <li>
    <a class="dropdown-item" href="../Time Series/c4week1.html">
 <span class="dropdown-text">W1:Sequences and Prediction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Time Series/c4week2.html">
 <span class="dropdown-text">W2:Deep Neural Networks for Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Time Series/c4week3.html">
 <span class="dropdown-text">W3:Recurrent Neural Networks for Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Time Series/c4week4.html">
 <span class="dropdown-text">W4:Real-world time series data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Time Series/c4week4 Sunspots.html">
 <span class="dropdown-text">W4:Real-world time series data sunspots</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tensorflow-tree-model" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">tensorflow tree model</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tensorflow-tree-model">    
        <li class="dropdown-header">tree model</li>
        <li>
    <a class="dropdown-item" href="../tree model/1 install package.html">
 <span class="dropdown-text">install pacakge</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tree model/2 Keras random forests regression model.html">
 <span class="dropdown-text">Keras random forests regression model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tree model/3 Keras tuned random forests regression model.html">
 <span class="dropdown-text">Keras tuned random forests regression model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tree model/4 Keras GBT regression model.html">
 <span class="dropdown-text">Keras Gradient BoostedTrees Model regression model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tree model/5 Keras tuned GBT regression model.html">
 <span class="dropdown-text">Keras tuned Gradient BoostedTrees Model regression model</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Convolutional Neural Networks in TensorFlow/c2week1.html">Convolutional Neural Networks in TensorFlow</a></li><li class="breadcrumb-item"><a href="../Convolutional Neural Networks in TensorFlow/c2week3.html">W3:Transfer learning</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Convolutional Neural Networks in TensorFlow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Convolutional Neural Networks in TensorFlow/c2week1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W1:Exploring a Larger Dataset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Convolutional Neural Networks in TensorFlow/c2week2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W2:Augmentation: A technique to avoid overfitting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Convolutional Neural Networks in TensorFlow/c2week3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">W3:Transfer learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Convolutional Neural Networks in TensorFlow/c2week4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W4:multi-class classification</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#download-data" id="toc-download-data" class="nav-link active" data-scroll-target="#download-data"><span class="header-section-number">1</span> download data</a>
  <ul class="collapse">
  <li><a href="#download-big-cats-and-dogs.zip-and-we-will-random-split-into-training-and-validation-folder" id="toc-download-big-cats-and-dogs.zip-and-we-will-random-split-into-training-and-validation-folder" class="nav-link" data-scroll-target="#download-big-cats-and-dogs.zip-and-we-will-random-split-into-training-and-validation-folder"><span class="header-section-number">1.1</span> download big cats-and-dogs.zip and we will random split into training and validation folder</a></li>
  </ul></li>
  <li><a href="#download-model-download-the-inception-v3-weights" id="toc-download-model-download-the-inception-v3-weights" class="nav-link" data-scroll-target="#download-model-download-the-inception-v3-weights"><span class="header-section-number">2</span> download model Download the inception v3 weights</a></li>
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data"><span class="header-section-number">3</span> Load the data</a></li>
  <li><a href="#pre_trained_model" id="toc-pre_trained_model" class="nav-link" data-scroll-target="#pre_trained_model"><span class="header-section-number">4</span> pre_trained_model</a></li>
  <li><a href="#base-model" id="toc-base-model" class="nav-link" data-scroll-target="#base-model"><span class="header-section-number">5</span> base model</a></li>
  <li><a href="#compile-model" id="toc-compile-model" class="nav-link" data-scroll-target="#compile-model"><span class="header-section-number">6</span> compile model</a></li>
  <li><a href="#callbacks" id="toc-callbacks" class="nav-link" data-scroll-target="#callbacks"><span class="header-section-number">7</span> Callbacks</a></li>
  <li><a href="#training-result" id="toc-training-result" class="nav-link" data-scroll-target="#training-result"><span class="header-section-number">8</span> training result</a></li>
  <li><a href="#resource" id="toc-resource" class="nav-link" data-scroll-target="#resource"><span class="header-section-number">9</span> resource:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Convolutional Neural Networks in TensorFlow/c2week1.html">Convolutional Neural Networks in TensorFlow</a></li><li class="breadcrumb-item"><a href="../Convolutional Neural Networks in TensorFlow/c2week3.html">W3:Transfer learning</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">W3:Transfer learning</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="530ec974" class="cell" data-execution_count="1">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shutil <span class="im">import</span> copyfile</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os <span class="im">import</span> getcwd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/31.png" class="img-fluid"></p>
<p><img src="images/32.png" class="img-fluid"></p>
<section id="download-data" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> download data</h1>
<section id="download-big-cats-and-dogs.zip-and-we-will-random-split-into-training-and-validation-folder" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="download-big-cats-and-dogs.zip-and-we-will-random-split-into-training-and-validation-folder"><span class="header-section-number">1.1</span> download big cats-and-dogs.zip and we will random split into training and validation folder</h2>
<div id="93c5503e" class="cell" data-execution_count="2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>os. getcwd()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="57033cf1" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'tmp'</span>):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="st">'tmp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="61b681d6" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>urllib.request.urlretrieve(<span class="st">"https://download.microsoft.com/download/3/E/1/3E1C3F21-ECDB-4869-8368-6DEBA77B919F/kagglecatsanddogs_5340.zip"</span>, <span class="st">"./tmp/cats-and-dogs.zip"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cd30399e" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>local_zip <span class="op">=</span> <span class="st">'./tmp/cats-and-dogs.zip'</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>zip_ref   <span class="op">=</span> zipfile.ZipFile(local_zip, <span class="st">'r'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>zip_ref.extractall(<span class="st">'./tmp'</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>zip_ref.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="download-model-download-the-inception-v3-weights" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> download model Download the inception v3 weights</h1>
<div id="f9f72b5f" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>urllib.request.urlretrieve(<span class="st">"https://storage.googleapis.com/mledu-datasets/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5"</span>, <span class="st">"./tmp/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="ae1d8fc0" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>os.remove(<span class="st">'./tmp/cats-and-dogs.zip'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8865a812" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">'./tmp/PetImages'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="2faa8ba3" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>source_path <span class="op">=</span> <span class="st">'/tmp/PetImages'</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>source_path_dogs <span class="op">=</span> os.path.join(source_path, <span class="st">'Dog'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>source_path_cats <span class="op">=</span> os.path.join(source_path, <span class="st">'Cat'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># os.listdir returns a list containing all files under the given path</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(os.listdir(source_path_dogs))<span class="sc">}</span><span class="ss"> images of dogs."</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(os.listdir(source_path_cats))<span class="sc">}</span><span class="ss"> images of cats."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="420460d2" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs'</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/training'</span>):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/training'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/testing'</span>): </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/testing'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/training/cats'</span>):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/training/cats'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/training/dogs'</span>):</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/training/dogs'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/testing/cats'</span>):</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/testing/cats'</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/testing/dogs'</span>):</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/testing/dogs'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="032f7823" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_data(SOURCE, TRAINING, TESTING, SPLIT_SIZE):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># YOUR CODE STARTS HERE</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    all_files <span class="op">=</span> []</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_name <span class="kw">in</span> os.listdir(SOURCE):</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> SOURCE <span class="op">+</span> file_name</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.getsize(file_path):</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            all_files.append(file_name)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st"> is zero length, so ignoring'</span>.<span class="bu">format</span>(file_name))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    n_files <span class="op">=</span> <span class="bu">len</span>(all_files)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    split_point <span class="op">=</span> <span class="bu">int</span>(n_files <span class="op">*</span> SPLIT_SIZE)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    shuffled <span class="op">=</span> random.sample(all_files, n_files)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    train_set <span class="op">=</span> shuffled[:split_point]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    test_set <span class="op">=</span> shuffled[split_point:]</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_name <span class="kw">in</span> train_set:</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        copyfile(SOURCE <span class="op">+</span> file_name, TRAINING <span class="op">+</span> file_name)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_name <span class="kw">in</span> test_set:</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        copyfile(SOURCE <span class="op">+</span> file_name, TESTING <span class="op">+</span> file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="9594eacf" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>split_size <span class="op">=</span> <span class="fl">.9</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>CAT_SOURCE_DIR <span class="op">=</span> <span class="st">"./tmp/PetImages/Cat/"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>TRAINING_CATS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/training/cats/"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>TESTING_CATS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/testing/cats/"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>DOG_SOURCE_DIR <span class="op">=</span> <span class="st">"./tmp/PetImages/Dog/"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>TRAINING_DOGS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/training/dogs/"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>TESTING_DOGS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/testing/dogs/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d7be6479" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>split_data(CAT_SOURCE_DIR, TRAINING_CATS_DIR, TESTING_CATS_DIR, split_size)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>split_data(DOG_SOURCE_DIR, TRAINING_DOGS_DIR, TESTING_DOGS_DIR, split_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="9eee4918" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/training/cats/'</span>)))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/training/dogs/'</span>)))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/testing/cats/'</span>)))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/testing/dogs/'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="22575e11" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'./tmp/cats-v-dogs/training/cats/11.jpg'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>im.size <span class="co"># (width,height) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-the-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Load the data</h1>
<div id="309d3d14" class="cell" data-execution_count="16">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>train_dir<span class="op">=</span><span class="st">'./tmp/cats-v-dogs/training/'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>validation_dir<span class="op">=</span><span class="st">'./tmp/cats-v-dogs/testing/'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ImageDataGenerator: All images will be resized to 150x150 and do augmentation to aviod over fiting</p>
<div id="4cb87807" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>train_datagen <span class="op">=</span> ImageDataGenerator(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>      rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      rotation_range<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>      width_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>      height_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      shear_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      zoom_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      horizontal_flip<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      fill_mode<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>test_datagen <span class="op">=</span> ImageDataGenerator(rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="2d15a99c" class="cell" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flow training images in batches of 20 using train_datagen generator</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>train_generator <span class="op">=</span> train_datagen.flow_from_directory(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        train_dir,  <span class="co"># This is the source directory for training images</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        target_size<span class="op">=</span>(<span class="dv">150</span>, <span class="dv">150</span>),  <span class="co"># All images will be resized to 150x150</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        batch_size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Since we use binary_crossentropy loss, we need binary labels</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        class_mode<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Flow validation images in batches of 20 using test_datagen generator</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>validation_generator <span class="op">=</span> test_datagen.flow_from_directory(</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        validation_dir,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        target_size<span class="op">=</span>(<span class="dv">150</span>, <span class="dv">150</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        batch_size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        class_mode<span class="op">=</span><span class="st">'binary'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Found 24998 images belonging to 2 classes.
Found 13013 images belonging to 2 classes.</code></pre>
</div>
</div>
</section>
<section id="pre_trained_model" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> pre_trained_model</h1>
<div id="063b364e" class="cell" data-execution_count="19">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the inception model  </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.inception_v3 <span class="im">import</span> InceptionV3</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance of the inception model from the local pre-trained weights</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>local_weights_file <span class="op">=</span> <span class="st">'./tmp/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="7bb48f9e" class="cell" data-execution_count="20">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pre_trained_model <span class="op">=</span> InceptionV3(input_shape <span class="op">=</span> (<span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">3</span>),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                  include_top <span class="op">=</span> <span class="va">False</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                  weights <span class="op">=</span> <span class="va">None</span>) </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>pre_trained_model.load_weights(local_weights_file)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make all the layers in the pre-trained model non-trainable</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> layer <span class="kw">in</span> pre_trained_model.layers:</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  layer.trainable <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="26876367" class="cell" data-execution_count="21">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pre_trained_model.summary()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d11b7bed" class="cell" data-execution_count="22">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>total_params <span class="op">=</span> pre_trained_model.count_params()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>num_trainable_params <span class="op">=</span> <span class="bu">sum</span>([w.shape.num_elements() <span class="cf">for</span> w <span class="kw">in</span> pre_trained_model.trainable_weights])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>total_params<span class="sc">:,}</span><span class="ss"> total parameters in this model."</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>num_trainable_params<span class="sc">:,}</span><span class="ss"> trainable parameters in this model."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>There are 21,802,784 total parameters in this model.
There are 0 trainable parameters in this model.</code></pre>
</div>
</div>
<div id="1566c95e" class="cell" data-execution_count="23">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose `mixed_7` as the last layer of your base model and not using layer after mixed7</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>last_layer <span class="op">=</span> pre_trained_model.get_layer(<span class="st">'mixed7'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#print('last layer output shape: ', last_layer.output_shape)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>last_output <span class="op">=</span> last_layer.output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="base-model" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> base model</h1>
<p><img src="images/33.png" class="img-fluid" width="457"></p>
<p>add Dropout to improve over fitting issue.</p>
<div id="69ac440f" class="cell" data-execution_count="24">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Flatten()(last_output)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># Add a fully connected layer with 1024 hidden units and ReLU activation</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>)(x)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a dropout rate of 0.2</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Dropout(<span class="fl">0.2</span>)(x)  </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a final sigmoid layer for classification</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'sigmoid'</span>)(x) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>final model</p>
<div id="60bf6ced" class="cell" data-execution_count="25">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Append the dense network to the base model</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> Model</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(pre_trained_model.<span class="bu">input</span>, x) </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary. See your dense network connected at the end.</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#model.summary()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="compile-model" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> compile model</h1>
<div id="2169171d" class="cell" data-execution_count="26">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># v2.11+ optimizer `tf.keras.optimizers.RMSprop` runs slowly on M1/M2 Macs</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#from tensorflow.keras.optimizers.legacy import RMSprop</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'binary_crossentropy'</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>              optimizer<span class="op">=</span>RMSprop(learning_rate<span class="op">=</span><span class="fl">0.001</span>),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>              metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="callbacks" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Callbacks</h1>
<div id="6daa2693" class="cell" data-execution_count="27">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> myCallback(tf.keras.callbacks.Callback):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> on_epoch_end(<span class="va">self</span>, epoch, logs<span class="op">=</span>{}):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(logs.get(<span class="st">'accuracy'</span>)<span class="op">&gt;</span><span class="fl">0.95</span>):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Reached 95% accuracy so cancelling training!"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.model.stop_training <span class="op">=</span> <span class="va">True</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate class</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>callbacks <span class="op">=</span> myCallback()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="5b1b07b7" class="cell" data-execution_count="28">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the new model with augmentation</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>      train_generator,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      steps_per_epoch<span class="op">=</span><span class="dv">100</span>,  <span class="co"># 2000 images = batch_size * steps</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      validation_data<span class="op">=</span>validation_generator,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      validation_steps<span class="op">=</span><span class="dv">50</span>,  <span class="co"># 1000 images = batch_size * steps</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      callbacks<span class="op">=</span>[callbacks]</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/10
  1/100  4:08 3s/step - accuracy: 0.5500 - loss: 0.7655  2/100  26s 266ms/step - accuracy: 0.5625 - loss: 4.0972  3/100  25s 267ms/step - accuracy: 0.5250 - loss: 8.6589  4/100  24s 255ms/step - accuracy: 0.5188 - loss: 9.9921  5/100  23s 251ms/step - accuracy: 0.5190 - loss: 10.3648  6/100  23s 248ms/step - accuracy: 0.5283 - loss: 10.2944  7/100  22s 246ms/step - accuracy: 0.5406 - loss: 10.0521  8/100  22s 244ms/step - accuracy: 0.5519 - loss: 9.7533   9/100  22s 243ms/step - accuracy: 0.5616 - loss: 9.4453 10/100  21s 242ms/step - accuracy: 0.5709 - loss: 9.1355 11/100  21s 241ms/step - accuracy: 0.5798 - loss: 8.8336 12/100  21s 240ms/step - accuracy: 0.5884 - loss: 8.5434 13/100  20s 240ms/step - accuracy: 0.5967 - loss: 8.2692 14/100  20s 239ms/step - accuracy: 0.6046 - loss: 8.0107 15/100  20s 239ms/step - accuracy: 0.6118 - loss: 7.7701 16/100  20s 238ms/step - accuracy: 0.6189 - loss: 7.5440 17/100  19s 238ms/step - accuracy: 0.6254 - loss: 7.3317 18/100  19s 238ms/step - accuracy: 0.6316 - loss: 7.1320 19/100  19s 237ms/step - accuracy: 0.6371 - loss: 6.9447 20/100  18s 237ms/step - accuracy: 0.6424 - loss: 6.7687 21/100  18s 237ms/step - accuracy: 0.6476 - loss: 6.6019 22/100  18s 237ms/step - accuracy: 0.6526 - loss: 6.4441 23/100  18s 237ms/step - accuracy: 0.6573 - loss: 6.2946 24/100  17s 237ms/step - accuracy: 0.6617 - loss: 6.1537 25/100  17s 236ms/step - accuracy: 0.6655 - loss: 6.0214 26/100  17s 236ms/step - accuracy: 0.6690 - loss: 5.8967 27/100  17s 236ms/step - accuracy: 0.6723 - loss: 5.7778 28/100  17s 237ms/step - accuracy: 0.6756 - loss: 5.6642 29/100  16s 237ms/step - accuracy: 0.6786 - loss: 5.5559 30/100  16s 237ms/step - accuracy: 0.6815 - loss: 5.4523 31/100  16s 237ms/step - accuracy: 0.6843 - loss: 5.3534 32/100  16s 236ms/step - accuracy: 0.6869 - loss: 5.2587 33/100  15s 237ms/step - accuracy: 0.6895 - loss: 5.1678 34/100  15s 237ms/step - accuracy: 0.6918 - loss: 5.0808 35/100  15s 237ms/step - accuracy: 0.6937 - loss: 4.9979 36/100  15s 237ms/step - accuracy: 0.6956 - loss: 4.9188 37/100  14s 237ms/step - accuracy: 0.6973 - loss: 4.8428 38/100  14s 237ms/step - accuracy: 0.6989 - loss: 4.7696 39/100  14s 237ms/step - accuracy: 0.7005 - loss: 4.6992 40/100  14s 237ms/step - accuracy: 0.7020 - loss: 4.6314 41/100  13s 237ms/step - accuracy: 0.7036 - loss: 4.5659 42/100  13s 237ms/step - accuracy: 0.7051 - loss: 4.5025 43/100  13s 236ms/step - accuracy: 0.7068 - loss: 4.4411 44/100  13s 236ms/step - accuracy: 0.7084 - loss: 4.3816 45/100  12s 236ms/step - accuracy: 0.7100 - loss: 4.3239 46/100  12s 236ms/step - accuracy: 0.7117 - loss: 4.2681 47/100  12s 236ms/step - accuracy: 0.7133 - loss: 4.2139 48/100  12s 236ms/step - accuracy: 0.7149 - loss: 4.1612 49/100  12s 236ms/step - accuracy: 0.7165 - loss: 4.1101 50/100  11s 236ms/step - accuracy: 0.7180 - loss: 4.0606 51/100  11s 236ms/step - accuracy: 0.7194 - loss: 4.0128 52/100  11s 236ms/step - accuracy: 0.7208 - loss: 3.9663 53/100  11s 236ms/step - accuracy: 0.7221 - loss: 3.9211 54/100  10s 236ms/step - accuracy: 0.7234 - loss: 3.8773 55/100  10s 236ms/step - accuracy: 0.7247 - loss: 3.8346 56/100  10s 236ms/step - accuracy: 0.7259 - loss: 3.7931 57/100  10s 236ms/step - accuracy: 0.7271 - loss: 3.7526 58/100  9s 236ms/step - accuracy: 0.7283 - loss: 3.7133  59/100  9s 236ms/step - accuracy: 0.7294 - loss: 3.6750 60/100  9s 236ms/step - accuracy: 0.7306 - loss: 3.6377 61/100  9s 236ms/step - accuracy: 0.7317 - loss: 3.6013 62/100  8s 236ms/step - accuracy: 0.7328 - loss: 3.5658 63/100  8s 236ms/step - accuracy: 0.7339 - loss: 3.5311 64/100  8s 236ms/step - accuracy: 0.7349 - loss: 3.4973 65/100  8s 236ms/step - accuracy: 0.7360 - loss: 3.4643 66/100  8s 236ms/step - accuracy: 0.7371 - loss: 3.4321 67/100  7s 236ms/step - accuracy: 0.7381 - loss: 3.4006 68/100  7s 235ms/step - accuracy: 0.7392 - loss: 3.3698 69/100  7s 235ms/step - accuracy: 0.7402 - loss: 3.3397 70/100  7s 235ms/step - accuracy: 0.7411 - loss: 3.3102 71/100  6s 235ms/step - accuracy: 0.7421 - loss: 3.2814 72/100  6s 235ms/step - accuracy: 0.7431 - loss: 3.2532 73/100  6s 235ms/step - accuracy: 0.7440 - loss: 3.2255 74/100  6s 235ms/step - accuracy: 0.7450 - loss: 3.1984 75/100  5s 235ms/step - accuracy: 0.7460 - loss: 3.1718 76/100  5s 235ms/step - accuracy: 0.7469 - loss: 3.1458 77/100  5s 235ms/step - accuracy: 0.7478 - loss: 3.1204 78/100  5s 235ms/step - accuracy: 0.7486 - loss: 3.0955 79/100  4s 235ms/step - accuracy: 0.7495 - loss: 3.0711 80/100  4s 235ms/step - accuracy: 0.7503 - loss: 3.0472 81/100  4s 235ms/step - accuracy: 0.7512 - loss: 3.0237 82/100  4s 235ms/step - accuracy: 0.7520 - loss: 3.0007 83/100  3s 235ms/step - accuracy: 0.7527 - loss: 2.9782 84/100  3s 235ms/step - accuracy: 0.7535 - loss: 2.9560 85/100  3s 235ms/step - accuracy: 0.7543 - loss: 2.9343 86/100  3s 235ms/step - accuracy: 0.7551 - loss: 2.9130 87/100  3s 235ms/step - accuracy: 0.7558 - loss: 2.8920 88/100  2s 235ms/step - accuracy: 0.7566 - loss: 2.8713 89/100  2s 235ms/step - accuracy: 0.7573 - loss: 2.8510 90/100  2s 235ms/step - accuracy: 0.7581 - loss: 2.8311 91/100  2s 235ms/step - accuracy: 0.7588 - loss: 2.8116 92/100  1s 235ms/step - accuracy: 0.7595 - loss: 2.7924 93/100  1s 235ms/step - accuracy: 0.7603 - loss: 2.7735 94/100  1s 235ms/step - accuracy: 0.7610 - loss: 2.7550 95/100  1s 235ms/step - accuracy: 0.7617 - loss: 2.7367 96/100  0s 235ms/step - accuracy: 0.7624 - loss: 2.7188 97/100  0s 235ms/step - accuracy: 0.7631 - loss: 2.7011 98/100  0s 235ms/step - accuracy: 0.7637 - loss: 2.6837 99/100  0s 235ms/step - accuracy: 0.7644 - loss: 2.6665100/100  0s 235ms/step - accuracy: 0.7651 - loss: 2.6497100/100  33s 312ms/step - accuracy: 0.7657 - loss: 2.6332 - val_accuracy: 0.9090 - val_loss: 0.2641
Epoch 2/10
  1/100  24s 249ms/step - accuracy: 1.0000 - loss: 0.1330  2/100  25s 260ms/step - accuracy: 0.9500 - loss: 0.1873  3/100  23s 244ms/step - accuracy: 0.9444 - loss: 0.1857  4/100  22s 239ms/step - accuracy: 0.9458 - loss: 0.1761  5/100  22s 237ms/step - accuracy: 0.9487 - loss: 0.1658  6/100  22s 237ms/step - accuracy: 0.9503 - loss: 0.1619  7/100  21s 236ms/step - accuracy: 0.9513 - loss: 0.1581  8/100  21s 236ms/step - accuracy: 0.9503 - loss: 0.1572  9/100  21s 235ms/step - accuracy: 0.9466 - loss: 0.1665 10/100  21s 234ms/step - accuracy: 0.9414 - loss: 0.1818 11/100  20s 235ms/step - accuracy: 0.9360 - loss: 0.1979 12/100  20s 234ms/step - accuracy: 0.9313 - loss: 0.2106 13/100  20s 234ms/step - accuracy: 0.9274 - loss: 0.2214 14/100  20s 234ms/step - accuracy: 0.9244 - loss: 0.2296 15/100  19s 234ms/step - accuracy: 0.9219 - loss: 0.2366 16/100  19s 234ms/step - accuracy: 0.9197 - loss: 0.2422 17/100  19s 234ms/step - accuracy: 0.9177 - loss: 0.2479 18/100  19s 234ms/step - accuracy: 0.9158 - loss: 0.2532 19/100  18s 234ms/step - accuracy: 0.9141 - loss: 0.2573 20/100  18s 234ms/step - accuracy: 0.9128 - loss: 0.2606 21/100  18s 234ms/step - accuracy: 0.9116 - loss: 0.2632 22/100  18s 233ms/step - accuracy: 0.9104 - loss: 0.2657 23/100  17s 233ms/step - accuracy: 0.9090 - loss: 0.2681 24/100  17s 233ms/step - accuracy: 0.9077 - loss: 0.2703 25/100  17s 233ms/step - accuracy: 0.9065 - loss: 0.2720 26/100  17s 233ms/step - accuracy: 0.9055 - loss: 0.2733 27/100  17s 233ms/step - accuracy: 0.9045 - loss: 0.2745 28/100  16s 233ms/step - accuracy: 0.9036 - loss: 0.2756 29/100  16s 233ms/step - accuracy: 0.9028 - loss: 0.2763 30/100  16s 233ms/step - accuracy: 0.9022 - loss: 0.2771 31/100  16s 233ms/step - accuracy: 0.9017 - loss: 0.2775 32/100  15s 233ms/step - accuracy: 0.9013 - loss: 0.2778 33/100  15s 233ms/step - accuracy: 0.9009 - loss: 0.2781 34/100  15s 233ms/step - accuracy: 0.9006 - loss: 0.2785 35/100  15s 233ms/step - accuracy: 0.9005 - loss: 0.2787 36/100  14s 233ms/step - accuracy: 0.9003 - loss: 0.2789 37/100  14s 233ms/step - accuracy: 0.9002 - loss: 0.2789 38/100  14s 233ms/step - accuracy: 0.9001 - loss: 0.2787 39/100  14s 233ms/step - accuracy: 0.9000 - loss: 0.2786 40/100  13s 232ms/step - accuracy: 0.9000 - loss: 0.2784 41/100  13s 232ms/step - accuracy: 0.8999 - loss: 0.2781 42/100  13s 232ms/step - accuracy: 0.8999 - loss: 0.2778 43/100  13s 232ms/step - accuracy: 0.9000 - loss: 0.2775 44/100  13s 233ms/step - accuracy: 0.9000 - loss: 0.2774 45/100  12s 232ms/step - accuracy: 0.9000 - loss: 0.2772 46/100  12s 232ms/step - accuracy: 0.9000 - loss: 0.2769 47/100  12s 232ms/step - accuracy: 0.9000 - loss: 0.2768 48/100  12s 232ms/step - accuracy: 0.9000 - loss: 0.2767 49/100  11s 232ms/step - accuracy: 0.9000 - loss: 0.2768 50/100  11s 232ms/step - accuracy: 0.8999 - loss: 0.2769 51/100  11s 232ms/step - accuracy: 0.8999 - loss: 0.2769 52/100  11s 232ms/step - accuracy: 0.8999 - loss: 0.2769 53/100  10s 232ms/step - accuracy: 0.9000 - loss: 0.2768 54/100  10s 232ms/step - accuracy: 0.9000 - loss: 0.2767 55/100  10s 232ms/step - accuracy: 0.9000 - loss: 0.2765 56/100  10s 232ms/step - accuracy: 0.9001 - loss: 0.2763 57/100  9s 232ms/step - accuracy: 0.9002 - loss: 0.2760  58/100  9s 232ms/step - accuracy: 0.9003 - loss: 0.2757 59/100  9s 232ms/step - accuracy: 0.9004 - loss: 0.2753 60/100  9s 232ms/step - accuracy: 0.9006 - loss: 0.2750 61/100  9s 232ms/step - accuracy: 0.9007 - loss: 0.2746 62/100  8s 232ms/step - accuracy: 0.9008 - loss: 0.2745 63/100  8s 232ms/step - accuracy: 0.9009 - loss: 0.2743 64/100  8s 232ms/step - accuracy: 0.9010 - loss: 0.2741 65/100  8s 232ms/step - accuracy: 0.9011 - loss: 0.2739 66/100  7s 232ms/step - accuracy: 0.9012 - loss: 0.2737 67/100  7s 232ms/step - accuracy: 0.9013 - loss: 0.2734 68/100  7s 232ms/step - accuracy: 0.9014 - loss: 0.2732 69/100  7s 232ms/step - accuracy: 0.9014 - loss: 0.2730 70/100  6s 232ms/step - accuracy: 0.9015 - loss: 0.2727 71/100  6s 232ms/step - accuracy: 0.9016 - loss: 0.2724 72/100  6s 232ms/step - accuracy: 0.9017 - loss: 0.2721 73/100  6s 232ms/step - accuracy: 0.9018 - loss: 0.2718 74/100  6s 232ms/step - accuracy: 0.9019 - loss: 0.2716 75/100  5s 233ms/step - accuracy: 0.9019 - loss: 0.2714 76/100  5s 233ms/step - accuracy: 0.9020 - loss: 0.2713 77/100  5s 233ms/step - accuracy: 0.9021 - loss: 0.2712 78/100  5s 233ms/step - accuracy: 0.9021 - loss: 0.2710 79/100  4s 233ms/step - accuracy: 0.9022 - loss: 0.2709 80/100  4s 233ms/step - accuracy: 0.9022 - loss: 0.2708 81/100  4s 233ms/step - accuracy: 0.9023 - loss: 0.2708 82/100  4s 233ms/step - accuracy: 0.9023 - loss: 0.2707 83/100  3s 233ms/step - accuracy: 0.9024 - loss: 0.2706 84/100  3s 233ms/step - accuracy: 0.9024 - loss: 0.2705 85/100  3s 233ms/step - accuracy: 0.9025 - loss: 0.2705 86/100  3s 233ms/step - accuracy: 0.9025 - loss: 0.2704 87/100  3s 233ms/step - accuracy: 0.9026 - loss: 0.2704 88/100  2s 233ms/step - accuracy: 0.9026 - loss: 0.2703 89/100  2s 233ms/step - accuracy: 0.9026 - loss: 0.2702 90/100  2s 233ms/step - accuracy: 0.9027 - loss: 0.2701 91/100  2s 233ms/step - accuracy: 0.9027 - loss: 0.2700 92/100  1s 233ms/step - accuracy: 0.9027 - loss: 0.2699 93/100  1s 233ms/step - accuracy: 0.9028 - loss: 0.2698 94/100  1s 233ms/step - accuracy: 0.9028 - loss: 0.2696 95/100  1s 233ms/step - accuracy: 0.9028 - loss: 0.2695 96/100  0s 233ms/step - accuracy: 0.9028 - loss: 0.2693 97/100  0s 233ms/step - accuracy: 0.9029 - loss: 0.2692 98/100  0s 233ms/step - accuracy: 0.9029 - loss: 0.2690 99/100  0s 233ms/step - accuracy: 0.9029 - loss: 0.2689100/100  0s 233ms/step - accuracy: 0.9029 - loss: 0.2687100/100  30s 302ms/step - accuracy: 0.9029 - loss: 0.2686 - val_accuracy: 0.9320 - val_loss: 0.1914
Epoch 3/10
  1/100  23s 239ms/step - accuracy: 0.9000 - loss: 0.4867  2/100  22s 233ms/step - accuracy: 0.9125 - loss: 0.3922  3/100  22s 236ms/step - accuracy: 0.8972 - loss: 0.3844  4/100  22s 235ms/step - accuracy: 0.8854 - loss: 0.3772  5/100  22s 235ms/step - accuracy: 0.8823 - loss: 0.3640  6/100  21s 233ms/step - accuracy: 0.8783 - loss: 0.3591  7/100  21s 234ms/step - accuracy: 0.8753 - loss: 0.3553  8/100  21s 234ms/step - accuracy: 0.8745 - loss: 0.3536  9/100  21s 234ms/step - accuracy: 0.8730 - loss: 0.3533 10/100  21s 234ms/step - accuracy: 0.8727 - loss: 0.3516 11/100  20s 234ms/step - accuracy: 0.8731 - loss: 0.3485 12/100  20s 233ms/step - accuracy: 0.8740 - loss: 0.3456 13/100  20s 233ms/step - accuracy: 0.8745 - loss: 0.3434 14/100  20s 234ms/step - accuracy: 0.8740 - loss: 0.3447 15/100  19s 234ms/step - accuracy: 0.8735 - loss: 0.3455 16/100  19s 234ms/step - accuracy: 0.8734 - loss: 0.3453 17/100  19s 234ms/step - accuracy: 0.8738 - loss: 0.3440 18/100  19s 234ms/step - accuracy: 0.8743 - loss: 0.3423 19/100  18s 234ms/step - accuracy: 0.8746 - loss: 0.3416 20/100  18s 234ms/step - accuracy: 0.8747 - loss: 0.3413 21/100  18s 234ms/step - accuracy: 0.8750 - loss: 0.3412 22/100  18s 234ms/step - accuracy: 0.8755 - loss: 0.3406 23/100  18s 234ms/step - accuracy: 0.8759 - loss: 0.3405 24/100  17s 234ms/step - accuracy: 0.8765 - loss: 0.3400 25/100  17s 234ms/step - accuracy: 0.8771 - loss: 0.3392 26/100  17s 234ms/step - accuracy: 0.8778 - loss: 0.3385 27/100  17s 234ms/step - accuracy: 0.8785 - loss: 0.3375 28/100  16s 234ms/step - accuracy: 0.8792 - loss: 0.3366 29/100  16s 234ms/step - accuracy: 0.8798 - loss: 0.3358 30/100  16s 233ms/step - accuracy: 0.8805 - loss: 0.3349 31/100  16s 234ms/step - accuracy: 0.8811 - loss: 0.3339 32/100  15s 234ms/step - accuracy: 0.8817 - loss: 0.3330 33/100  15s 234ms/step - accuracy: 0.8821 - loss: 0.3326 34/100  15s 233ms/step - accuracy: 0.8825 - loss: 0.3320 35/100  15s 233ms/step - accuracy: 0.8829 - loss: 0.3313 36/100  14s 233ms/step - accuracy: 0.8833 - loss: 0.3305 37/100  14s 233ms/step - accuracy: 0.8837 - loss: 0.3295 38/100  14s 233ms/step - accuracy: 0.8840 - loss: 0.3286 39/100  14s 234ms/step - accuracy: 0.8843 - loss: 0.3277 40/100  14s 234ms/step - accuracy: 0.8846 - loss: 0.3266 41/100  13s 233ms/step - accuracy: 0.8849 - loss: 0.3256 42/100  13s 234ms/step - accuracy: 0.8852 - loss: 0.3248 43/100  13s 234ms/step - accuracy: 0.8853 - loss: 0.3243 44/100  13s 234ms/step - accuracy: 0.8856 - loss: 0.3236 45/100  12s 234ms/step - accuracy: 0.8858 - loss: 0.3230 46/100  12s 234ms/step - accuracy: 0.8859 - loss: 0.3224 47/100  12s 234ms/step - accuracy: 0.8861 - loss: 0.3219 48/100  12s 234ms/step - accuracy: 0.8862 - loss: 0.3213 49/100  11s 234ms/step - accuracy: 0.8864 - loss: 0.3208 50/100  11s 234ms/step - accuracy: 0.8865 - loss: 0.3202 51/100  11s 234ms/step - accuracy: 0.8866 - loss: 0.3196 52/100  11s 234ms/step - accuracy: 0.8867 - loss: 0.3190 53/100  11s 234ms/step - accuracy: 0.8869 - loss: 0.3183 54/100  10s 234ms/step - accuracy: 0.8871 - loss: 0.3176 55/100  10s 234ms/step - accuracy: 0.8873 - loss: 0.3170 56/100  10s 234ms/step - accuracy: 0.8874 - loss: 0.3163 57/100  10s 234ms/step - accuracy: 0.8876 - loss: 0.3158 58/100  9s 234ms/step - accuracy: 0.8877 - loss: 0.3153  59/100  9s 234ms/step - accuracy: 0.8878 - loss: 0.3147 60/100  9s 234ms/step - accuracy: 0.8880 - loss: 0.3142 61/100  9s 234ms/step - accuracy: 0.8881 - loss: 0.3137 62/100  8s 234ms/step - accuracy: 0.8882 - loss: 0.3131 63/100  8s 234ms/step - accuracy: 0.8883 - loss: 0.3125 64/100  8s 234ms/step - accuracy: 0.8885 - loss: 0.3119 65/100  8s 234ms/step - accuracy: 0.8886 - loss: 0.3113 66/100  7s 234ms/step - accuracy: 0.8888 - loss: 0.3107 67/100  7s 234ms/step - accuracy: 0.8889 - loss: 0.3101 68/100  7s 234ms/step - accuracy: 0.8891 - loss: 0.3094 69/100  7s 234ms/step - accuracy: 0.8893 - loss: 0.3088 70/100  7s 234ms/step - accuracy: 0.8895 - loss: 0.3081 71/100  6s 235ms/step - accuracy: 0.8896 - loss: 0.3076 72/100  6s 235ms/step - accuracy: 0.8898 - loss: 0.3070 73/100  6s 235ms/step - accuracy: 0.8899 - loss: 0.3064 74/100  6s 235ms/step - accuracy: 0.8901 - loss: 0.3058 75/100  5s 235ms/step - accuracy: 0.8903 - loss: 0.3053 76/100  5s 235ms/step - accuracy: 0.8904 - loss: 0.3048 77/100  5s 235ms/step - accuracy: 0.8905 - loss: 0.3043 78/100  5s 235ms/step - accuracy: 0.8906 - loss: 0.3039 79/100  4s 235ms/step - accuracy: 0.8908 - loss: 0.3035 80/100  4s 235ms/step - accuracy: 0.8909 - loss: 0.3030 81/100  4s 235ms/step - accuracy: 0.8910 - loss: 0.3026 82/100  4s 235ms/step - accuracy: 0.8912 - loss: 0.3021 83/100  3s 235ms/step - accuracy: 0.8913 - loss: 0.3017 84/100  3s 235ms/step - accuracy: 0.8914 - loss: 0.3013 85/100  3s 235ms/step - accuracy: 0.8915 - loss: 0.3009 86/100  3s 235ms/step - accuracy: 0.8916 - loss: 0.3004 87/100  3s 235ms/step - accuracy: 0.8918 - loss: 0.3000 88/100  2s 235ms/step - accuracy: 0.8919 - loss: 0.2996 89/100  2s 235ms/step - accuracy: 0.8921 - loss: 0.2991 90/100  2s 235ms/step - accuracy: 0.8922 - loss: 0.2986 91/100  2s 235ms/step - accuracy: 0.8923 - loss: 0.2982 92/100  1s 235ms/step - accuracy: 0.8925 - loss: 0.2977 93/100  1s 235ms/step - accuracy: 0.8926 - loss: 0.2973 94/100  1s 235ms/step - accuracy: 0.8927 - loss: 0.2968 95/100  1s 235ms/step - accuracy: 0.8928 - loss: 0.2964 96/100  0s 235ms/step - accuracy: 0.8930 - loss: 0.2959 97/100  0s 235ms/step - accuracy: 0.8931 - loss: 0.2955 98/100  0s 235ms/step - accuracy: 0.8932 - loss: 0.2951 99/100  0s 235ms/step - accuracy: 0.8934 - loss: 0.2946100/100  0s 235ms/step - accuracy: 0.8935 - loss: 0.2942100/100  31s 306ms/step - accuracy: 0.8936 - loss: 0.2938 - val_accuracy: 0.9570 - val_loss: 0.1224
Epoch 4/10
  1/100  25s 253ms/step - accuracy: 0.9000 - loss: 0.1417  2/100  23s 235ms/step - accuracy: 0.9125 - loss: 0.1968  3/100  22s 234ms/step - accuracy: 0.9139 - loss: 0.2158  4/100  22s 236ms/step - accuracy: 0.9167 - loss: 0.2190  5/100  22s 237ms/step - accuracy: 0.9193 - loss: 0.2155  6/100  22s 237ms/step - accuracy: 0.9203 - loss: 0.2141  7/100  22s 237ms/step - accuracy: 0.9204 - loss: 0.2129  8/100  21s 238ms/step - accuracy: 0.9210 - loss: 0.2119  9/100  21s 237ms/step - accuracy: 0.9211 - loss: 0.2140 10/100  21s 237ms/step - accuracy: 0.9210 - loss: 0.2159 11/100  21s 237ms/step - accuracy: 0.9212 - loss: 0.2175 12/100  20s 236ms/step - accuracy: 0.9212 - loss: 0.2193 13/100  20s 236ms/step - accuracy: 0.9207 - loss: 0.2214 14/100  20s 236ms/step - accuracy: 0.9200 - loss: 0.2228 15/100  20s 236ms/step - accuracy: 0.9198 - loss: 0.2232 16/100  19s 236ms/step - accuracy: 0.9193 - loss: 0.2235 17/100  19s 236ms/step - accuracy: 0.9182 - loss: 0.2254 18/100  19s 236ms/step - accuracy: 0.9169 - loss: 0.2272 19/100  19s 236ms/step - accuracy: 0.9158 - loss: 0.2284 20/100  18s 236ms/step - accuracy: 0.9149 - loss: 0.2291 21/100  18s 237ms/step - accuracy: 0.9143 - loss: 0.2294 22/100  18s 237ms/step - accuracy: 0.9137 - loss: 0.2302 23/100  18s 237ms/step - accuracy: 0.9132 - loss: 0.2307 24/100  17s 237ms/step - accuracy: 0.9128 - loss: 0.2309 25/100  17s 237ms/step - accuracy: 0.9124 - loss: 0.2312 26/100  17s 237ms/step - accuracy: 0.9121 - loss: 0.2314 27/100  17s 237ms/step - accuracy: 0.9119 - loss: 0.2314 28/100  17s 237ms/step - accuracy: 0.9116 - loss: 0.2313 29/100  16s 237ms/step - accuracy: 0.9115 - loss: 0.2311 30/100  16s 237ms/step - accuracy: 0.9114 - loss: 0.2307 31/100  16s 237ms/step - accuracy: 0.9114 - loss: 0.2302 32/100  16s 236ms/step - accuracy: 0.9113 - loss: 0.2298 33/100  15s 236ms/step - accuracy: 0.9111 - loss: 0.2295 34/100  15s 236ms/step - accuracy: 0.9109 - loss: 0.2292 35/100  15s 237ms/step - accuracy: 0.9108 - loss: 0.2290 36/100  15s 236ms/step - accuracy: 0.9105 - loss: 0.2290 37/100  14s 236ms/step - accuracy: 0.9103 - loss: 0.2289 38/100  14s 237ms/step - accuracy: 0.9101 - loss: 0.2289 39/100  14s 237ms/step - accuracy: 0.9098 - loss: 0.2290 40/100  14s 237ms/step - accuracy: 0.9097 - loss: 0.2289 41/100  13s 237ms/step - accuracy: 0.9095 - loss: 0.2289 42/100  13s 237ms/step - accuracy: 0.9093 - loss: 0.2290 43/100  13s 237ms/step - accuracy: 0.9092 - loss: 0.2291 44/100  13s 237ms/step - accuracy: 0.9091 - loss: 0.2290 45/100  13s 237ms/step - accuracy: 0.9090 - loss: 0.2289 46/100  12s 236ms/step - accuracy: 0.9089 - loss: 0.2287 47/100  12s 237ms/step - accuracy: 0.9089 - loss: 0.2286 48/100  12s 237ms/step - accuracy: 0.9088 - loss: 0.2285 49/100  12s 237ms/step - accuracy: 0.9087 - loss: 0.2284 50/100  11s 237ms/step - accuracy: 0.9086 - loss: 0.2283 51/100  11s 237ms/step - accuracy: 0.9086 - loss: 0.2282 52/100  11s 237ms/step - accuracy: 0.9087 - loss: 0.2279 53/100  11s 237ms/step - accuracy: 0.9087 - loss: 0.2277 54/100  10s 237ms/step - accuracy: 0.9087 - loss: 0.2275 55/100  10s 237ms/step - accuracy: 0.9087 - loss: 0.2275 56/100  10s 237ms/step - accuracy: 0.9086 - loss: 0.2276 57/100  10s 237ms/step - accuracy: 0.9086 - loss: 0.2276 58/100  9s 237ms/step - accuracy: 0.9085 - loss: 0.2277  59/100  9s 237ms/step - accuracy: 0.9085 - loss: 0.2277 60/100  9s 237ms/step - accuracy: 0.9085 - loss: 0.2277 61/100  9s 237ms/step - accuracy: 0.9084 - loss: 0.2277 62/100  9s 237ms/step - accuracy: 0.9084 - loss: 0.2278 63/100  8s 237ms/step - accuracy: 0.9084 - loss: 0.2279 64/100  8s 238ms/step - accuracy: 0.9083 - loss: 0.2281 65/100  8s 238ms/step - accuracy: 0.9083 - loss: 0.2282 66/100  8s 239ms/step - accuracy: 0.9083 - loss: 0.2283 67/100  7s 239ms/step - accuracy: 0.9082 - loss: 0.2284 68/100  7s 239ms/step - accuracy: 0.9082 - loss: 0.2285 69/100  7s 239ms/step - accuracy: 0.9082 - loss: 0.2285 70/100  7s 239ms/step - accuracy: 0.9082 - loss: 0.2285 71/100  6s 239ms/step - accuracy: 0.9082 - loss: 0.2286 72/100  6s 239ms/step - accuracy: 0.9081 - loss: 0.2287 73/100  6s 239ms/step - accuracy: 0.9080 - loss: 0.2287 74/100  6s 239ms/step - accuracy: 0.9079 - loss: 0.2288 75/100  5s 239ms/step - accuracy: 0.9078 - loss: 0.2289 76/100  5s 238ms/step - accuracy: 0.9077 - loss: 0.2290 77/100  5s 238ms/step - accuracy: 0.9076 - loss: 0.2291 78/100  5s 238ms/step - accuracy: 0.9076 - loss: 0.2292 79/100  4s 238ms/step - accuracy: 0.9075 - loss: 0.2293 80/100  4s 238ms/step - accuracy: 0.9074 - loss: 0.2293 81/100  4s 238ms/step - accuracy: 0.9073 - loss: 0.2294 82/100  4s 238ms/step - accuracy: 0.9073 - loss: 0.2294 83/100  4s 238ms/step - accuracy: 0.9072 - loss: 0.2295 84/100  3s 238ms/step - accuracy: 0.9071 - loss: 0.2295 85/100  3s 238ms/step - accuracy: 0.9071 - loss: 0.2295 86/100  3s 237ms/step - accuracy: 0.9070 - loss: 0.2296 87/100  3s 237ms/step - accuracy: 0.9070 - loss: 0.2296 88/100  2s 237ms/step - accuracy: 0.9070 - loss: 0.2296 89/100  2s 237ms/step - accuracy: 0.9070 - loss: 0.2296 90/100  2s 237ms/step - accuracy: 0.9070 - loss: 0.2295 91/100  2s 237ms/step - accuracy: 0.9070 - loss: 0.2295 92/100  1s 237ms/step - accuracy: 0.9070 - loss: 0.2295 93/100  1s 237ms/step - accuracy: 0.9070 - loss: 0.2294 94/100  1s 237ms/step - accuracy: 0.9070 - loss: 0.2293 95/100  1s 237ms/step - accuracy: 0.9070 - loss: 0.2292 96/100  0s 237ms/step - accuracy: 0.9070 - loss: 0.2292 97/100  0s 236ms/step - accuracy: 0.9071 - loss: 0.2291 98/100  0s 236ms/step - accuracy: 0.9071 - loss: 0.2290 99/100  0s 236ms/step - accuracy: 0.9071 - loss: 0.2290100/100  0s 236ms/step - accuracy: 0.9071 - loss: 0.2290100/100  30s 305ms/step - accuracy: 0.9072 - loss: 0.2289 - val_accuracy: 0.9640 - val_loss: 0.1050
Epoch 5/10
  1/100  23s 239ms/step - accuracy: 1.0000 - loss: 0.0107  2/100  22s 234ms/step - accuracy: 0.9500 - loss: 0.1417  3/100  22s 232ms/step - accuracy: 0.9333 - loss: 0.1711  4/100  22s 231ms/step - accuracy: 0.9250 - loss: 0.1840  5/100  21s 231ms/step - accuracy: 0.9160 - loss: 0.2029  6/100  21s 232ms/step - accuracy: 0.9078 - loss: 0.2264  7/100  21s 232ms/step - accuracy: 0.9046 - loss: 0.2362  8/100  21s 233ms/step - accuracy: 0.9025 - loss: 0.2435  9/100  22s 247ms/step - accuracy: 0.8985 - loss: 0.2556 10/100  22s 250ms/step - accuracy: 0.8942 - loss: 0.2676 11/100  22s 249ms/step - accuracy: 0.8901 - loss: 0.2775 12/100  21s 248ms/step - accuracy: 0.8878 - loss: 0.2833 13/100  21s 247ms/step - accuracy: 0.8867 - loss: 0.2864 14/100  21s 246ms/step - accuracy: 0.8856 - loss: 0.2892 15/100  20s 245ms/step - accuracy: 0.8850 - loss: 0.2908 16/100  20s 245ms/step - accuracy: 0.8844 - loss: 0.2922 17/100  20s 243ms/step - accuracy: 0.8841 - loss: 0.2928 18/100  19s 243ms/step - accuracy: 0.8839 - loss: 0.2932 19/100  19s 242ms/step - accuracy: 0.8839 - loss: 0.2931 20/100  19s 242ms/step - accuracy: 0.8842 - loss: 0.2923 21/100  19s 241ms/step - accuracy: 0.8844 - loss: 0.2918 22/100  18s 241ms/step - accuracy: 0.8845 - loss: 0.2920 23/100  18s 240ms/step - accuracy: 0.8847 - loss: 0.2917 24/100  18s 240ms/step - accuracy: 0.8850 - loss: 0.2911 25/100  17s 240ms/step - accuracy: 0.8854 - loss: 0.2902 26/100  17s 239ms/step - accuracy: 0.8858 - loss: 0.2892 27/100  17s 239ms/step - accuracy: 0.8863 - loss: 0.2881 28/100  17s 239ms/step - accuracy: 0.8868 - loss: 0.2869 29/100  16s 239ms/step - accuracy: 0.8872 - loss: 0.2859 30/100  16s 239ms/step - accuracy: 0.8877 - loss: 0.2846 31/100  16s 239ms/step - accuracy: 0.8881 - loss: 0.2836 32/100  16s 239ms/step - accuracy: 0.8883 - loss: 0.2829 33/100  15s 238ms/step - accuracy: 0.8886 - loss: 0.2823 34/100  15s 238ms/step - accuracy: 0.8888 - loss: 0.2817 35/100  15s 238ms/step - accuracy: 0.8892 - loss: 0.2809 36/100  15s 238ms/step - accuracy: 0.8895 - loss: 0.2801 37/100  15s 238ms/step - accuracy: 0.8899 - loss: 0.2792 38/100  14s 238ms/step - accuracy: 0.8902 - loss: 0.2784 39/100  14s 238ms/step - accuracy: 0.8905 - loss: 0.2776 40/100  14s 238ms/step - accuracy: 0.8908 - loss: 0.2767 41/100  14s 238ms/step - accuracy: 0.8912 - loss: 0.2759 42/100  13s 238ms/step - accuracy: 0.8915 - loss: 0.2752 43/100  13s 238ms/step - accuracy: 0.8918 - loss: 0.2744 44/100  13s 238ms/step - accuracy: 0.8921 - loss: 0.2736 45/100  13s 238ms/step - accuracy: 0.8924 - loss: 0.2728 46/100  12s 238ms/step - accuracy: 0.8927 - loss: 0.2719 47/100  12s 238ms/step - accuracy: 0.8930 - loss: 0.2711 48/100  12s 238ms/step - accuracy: 0.8933 - loss: 0.2703 49/100  12s 238ms/step - accuracy: 0.8936 - loss: 0.2694 50/100  11s 238ms/step - accuracy: 0.8939 - loss: 0.2685 51/100  11s 238ms/step - accuracy: 0.8942 - loss: 0.2676 52/100  11s 238ms/step - accuracy: 0.8945 - loss: 0.2668 53/100  11s 238ms/step - accuracy: 0.8948 - loss: 0.2659 54/100  10s 238ms/step - accuracy: 0.8951 - loss: 0.2651 55/100  10s 238ms/step - accuracy: 0.8954 - loss: 0.2643 56/100  10s 238ms/step - accuracy: 0.8956 - loss: 0.2635 57/100  10s 237ms/step - accuracy: 0.8959 - loss: 0.2627 58/100  9s 237ms/step - accuracy: 0.8962 - loss: 0.2618  59/100  9s 237ms/step - accuracy: 0.8965 - loss: 0.2610 60/100  9s 237ms/step - accuracy: 0.8967 - loss: 0.2602 61/100  9s 237ms/step - accuracy: 0.8970 - loss: 0.2594 62/100  9s 237ms/step - accuracy: 0.8973 - loss: 0.2586 63/100  8s 237ms/step - accuracy: 0.8975 - loss: 0.2578 64/100  8s 238ms/step - accuracy: 0.8978 - loss: 0.2570 65/100  8s 237ms/step - accuracy: 0.8981 - loss: 0.2562 66/100  8s 237ms/step - accuracy: 0.8983 - loss: 0.2554 67/100  7s 237ms/step - accuracy: 0.8986 - loss: 0.2547 68/100  7s 237ms/step - accuracy: 0.8988 - loss: 0.2540 69/100  7s 237ms/step - accuracy: 0.8991 - loss: 0.2532 70/100  7s 237ms/step - accuracy: 0.8993 - loss: 0.2525 71/100  6s 237ms/step - accuracy: 0.8996 - loss: 0.2518 72/100  6s 237ms/step - accuracy: 0.8998 - loss: 0.2511 73/100  6s 237ms/step - accuracy: 0.9000 - loss: 0.2505 74/100  6s 237ms/step - accuracy: 0.9002 - loss: 0.2500 75/100  5s 237ms/step - accuracy: 0.9004 - loss: 0.2495 76/100  5s 237ms/step - accuracy: 0.9006 - loss: 0.2490 77/100  5s 238ms/step - accuracy: 0.9007 - loss: 0.2486 78/100  5s 239ms/step - accuracy: 0.9009 - loss: 0.2481 79/100  5s 240ms/step - accuracy: 0.9011 - loss: 0.2477 80/100  4s 240ms/step - accuracy: 0.9012 - loss: 0.2473 81/100  4s 240ms/step - accuracy: 0.9014 - loss: 0.2469 82/100  4s 240ms/step - accuracy: 0.9015 - loss: 0.2464 83/100  4s 240ms/step - accuracy: 0.9016 - loss: 0.2460 84/100  3s 240ms/step - accuracy: 0.9018 - loss: 0.2456 85/100  3s 240ms/step - accuracy: 0.9019 - loss: 0.2452 86/100  3s 240ms/step - accuracy: 0.9021 - loss: 0.2448 87/100  3s 240ms/step - accuracy: 0.9022 - loss: 0.2444 88/100  2s 240ms/step - accuracy: 0.9024 - loss: 0.2440 89/100  2s 240ms/step - accuracy: 0.9025 - loss: 0.2435 90/100  2s 240ms/step - accuracy: 0.9027 - loss: 0.2432 91/100  2s 240ms/step - accuracy: 0.9028 - loss: 0.2428 92/100  1s 240ms/step - accuracy: 0.9029 - loss: 0.2425 93/100  1s 240ms/step - accuracy: 0.9030 - loss: 0.2422 94/100  1s 240ms/step - accuracy: 0.9031 - loss: 0.2419 95/100  1s 240ms/step - accuracy: 0.9032 - loss: 0.2416 96/100  0s 240ms/step - accuracy: 0.9033 - loss: 0.2413 97/100  0s 240ms/step - accuracy: 0.9034 - loss: 0.2410 98/100  0s 240ms/step - accuracy: 0.9035 - loss: 0.2406 99/100  0s 240ms/step - accuracy: 0.9036 - loss: 0.2403100/100  0s 240ms/step - accuracy: 0.9037 - loss: 0.2400100/100  31s 313ms/step - accuracy: 0.9038 - loss: 0.2397 - val_accuracy: 0.9650 - val_loss: 0.0877
Epoch 6/10
  1/100  26s 268ms/step - accuracy: 0.9500 - loss: 0.1672  2/100  26s 274ms/step - accuracy: 0.9625 - loss: 0.1346  3/100  27s 281ms/step - accuracy: 0.9528 - loss: 0.1386  4/100  26s 272ms/step - accuracy: 0.9490 - loss: 0.1405  5/100  25s 272ms/step - accuracy: 0.9472 - loss: 0.1412  6/100  26s 282ms/step - accuracy: 0.9476 - loss: 0.1381  7/100  27s 293ms/step - accuracy: 0.9490 - loss: 0.1342  8/100  26s 290ms/step - accuracy: 0.9499 - loss: 0.1328  9/100  26s 288ms/step - accuracy: 0.9499 - loss: 0.1332 10/100  25s 286ms/step - accuracy: 0.9494 - loss: 0.1358 11/100  25s 282ms/step - accuracy: 0.9486 - loss: 0.1397 12/100  24s 279ms/step - accuracy: 0.9481 - loss: 0.1428 13/100  23s 276ms/step - accuracy: 0.9470 - loss: 0.1464 14/100  23s 273ms/step - accuracy: 0.9462 - loss: 0.1489 15/100  22s 270ms/step - accuracy: 0.9454 - loss: 0.1511 16/100  22s 270ms/step - accuracy: 0.9447 - loss: 0.1527 17/100  22s 268ms/step - accuracy: 0.9443 - loss: 0.1536 18/100  21s 267ms/step - accuracy: 0.9440 - loss: 0.1545 19/100  21s 266ms/step - accuracy: 0.9436 - loss: 0.1557 20/100  21s 266ms/step - accuracy: 0.9433 - loss: 0.1565 21/100  20s 266ms/step - accuracy: 0.9430 - loss: 0.1572 22/100  20s 264ms/step - accuracy: 0.9428 - loss: 0.1575 23/100  20s 264ms/step - accuracy: 0.9426 - loss: 0.1579 24/100  20s 263ms/step - accuracy: 0.9426 - loss: 0.1582 25/100  19s 262ms/step - accuracy: 0.9425 - loss: 0.1583 26/100  19s 261ms/step - accuracy: 0.9425 - loss: 0.1588 27/100  18s 260ms/step - accuracy: 0.9423 - loss: 0.1596 28/100  18s 259ms/step - accuracy: 0.9420 - loss: 0.1609 29/100  18s 258ms/step - accuracy: 0.9415 - loss: 0.1631 30/100  18s 257ms/step - accuracy: 0.9411 - loss: 0.1651 31/100  17s 256ms/step - accuracy: 0.9405 - loss: 0.1671 32/100  17s 256ms/step - accuracy: 0.9400 - loss: 0.1689 33/100  17s 256ms/step - accuracy: 0.9395 - loss: 0.1705 34/100  16s 255ms/step - accuracy: 0.9391 - loss: 0.1719 35/100  16s 255ms/step - accuracy: 0.9386 - loss: 0.1734 36/100  16s 255ms/step - accuracy: 0.9383 - loss: 0.1748 37/100  16s 255ms/step - accuracy: 0.9379 - loss: 0.1760 38/100  15s 255ms/step - accuracy: 0.9376 - loss: 0.1770 39/100  15s 255ms/step - accuracy: 0.9372 - loss: 0.1783 40/100  15s 258ms/step - accuracy: 0.9368 - loss: 0.1795 41/100  15s 259ms/step - accuracy: 0.9365 - loss: 0.1806 42/100  14s 259ms/step - accuracy: 0.9361 - loss: 0.1817 43/100  14s 259ms/step - accuracy: 0.9357 - loss: 0.1827 44/100  14s 258ms/step - accuracy: 0.9354 - loss: 0.1836 45/100  14s 258ms/step - accuracy: 0.9351 - loss: 0.1844 46/100  13s 258ms/step - accuracy: 0.9347 - loss: 0.1852 47/100  13s 258ms/step - accuracy: 0.9344 - loss: 0.1858 48/100  13s 258ms/step - accuracy: 0.9341 - loss: 0.1865 49/100  13s 259ms/step - accuracy: 0.9338 - loss: 0.1871 50/100  12s 259ms/step - accuracy: 0.9336 - loss: 0.1876 51/100  12s 258ms/step - accuracy: 0.9333 - loss: 0.1881 52/100  12s 258ms/step - accuracy: 0.9330 - loss: 0.1886 53/100  12s 259ms/step - accuracy: 0.9327 - loss: 0.1891 54/100  11s 259ms/step - accuracy: 0.9325 - loss: 0.1895 55/100  11s 259ms/step - accuracy: 0.9322 - loss: 0.1899 56/100  11s 259ms/step - accuracy: 0.9320 - loss: 0.1904 57/100  11s 259ms/step - accuracy: 0.9318 - loss: 0.1908 58/100  10s 258ms/step - accuracy: 0.9315 - loss: 0.1911 59/100  10s 258ms/step - accuracy: 0.9313 - loss: 0.1915 60/100  10s 258ms/step - accuracy: 0.9311 - loss: 0.1918 61/100  10s 258ms/step - accuracy: 0.9309 - loss: 0.1921 62/100  9s 258ms/step - accuracy: 0.9307 - loss: 0.1923  63/100  9s 259ms/step - accuracy: 0.9306 - loss: 0.1925 64/100  9s 260ms/step - accuracy: 0.9304 - loss: 0.1926 65/100  9s 260ms/step - accuracy: 0.9302 - loss: 0.1928 66/100  8s 260ms/step - accuracy: 0.9300 - loss: 0.1930 67/100  8s 260ms/step - accuracy: 0.9299 - loss: 0.1932 68/100  8s 259ms/step - accuracy: 0.9297 - loss: 0.1933 69/100  8s 259ms/step - accuracy: 0.9295 - loss: 0.1935 70/100  7s 259ms/step - accuracy: 0.9293 - loss: 0.1936 71/100  7s 259ms/step - accuracy: 0.9292 - loss: 0.1938 72/100  7s 259ms/step - accuracy: 0.9290 - loss: 0.1939 73/100  6s 258ms/step - accuracy: 0.9289 - loss: 0.1940 74/100  6s 258ms/step - accuracy: 0.9288 - loss: 0.1940 75/100  6s 258ms/step - accuracy: 0.9286 - loss: 0.1941 76/100  6s 258ms/step - accuracy: 0.9285 - loss: 0.1942 77/100  5s 259ms/step - accuracy: 0.9284 - loss: 0.1943 78/100  5s 258ms/step - accuracy: 0.9283 - loss: 0.1943 79/100  5s 258ms/step - accuracy: 0.9282 - loss: 0.1943 80/100  5s 258ms/step - accuracy: 0.9281 - loss: 0.1944 81/100  4s 258ms/step - accuracy: 0.9280 - loss: 0.1944 82/100  4s 257ms/step - accuracy: 0.9279 - loss: 0.1944 83/100  4s 257ms/step - accuracy: 0.9279 - loss: 0.1944 84/100  4s 257ms/step - accuracy: 0.9278 - loss: 0.1944 85/100  3s 257ms/step - accuracy: 0.9277 - loss: 0.1944 86/100  3s 257ms/step - accuracy: 0.9276 - loss: 0.1945 87/100  3s 257ms/step - accuracy: 0.9275 - loss: 0.1946 88/100  3s 256ms/step - accuracy: 0.9275 - loss: 0.1946 89/100  2s 256ms/step - accuracy: 0.9274 - loss: 0.1947 90/100  2s 256ms/step - accuracy: 0.9273 - loss: 0.1947 91/100  2s 256ms/step - accuracy: 0.9272 - loss: 0.1947 92/100  2s 256ms/step - accuracy: 0.9272 - loss: 0.1948 93/100  1s 255ms/step - accuracy: 0.9271 - loss: 0.1948 94/100  1s 255ms/step - accuracy: 0.9270 - loss: 0.1949 95/100  1s 255ms/step - accuracy: 0.9269 - loss: 0.1949 96/100  1s 255ms/step - accuracy: 0.9269 - loss: 0.1950 97/100  0s 255ms/step - accuracy: 0.9268 - loss: 0.1951 98/100  0s 255ms/step - accuracy: 0.9267 - loss: 0.1951 99/100  0s 254ms/step - accuracy: 0.9267 - loss: 0.1952100/100  0s 254ms/step - accuracy: 0.9266 - loss: 0.1952100/100  33s 327ms/step - accuracy: 0.9266 - loss: 0.1953 - val_accuracy: 0.9390 - val_loss: 0.1570
Epoch 7/10
  1/100  25s 254ms/step - accuracy: 0.9000 - loss: 0.1678  2/100  24s 253ms/step - accuracy: 0.8875 - loss: 0.2080  3/100  25s 262ms/step - accuracy: 0.8917 - loss: 0.2037  4/100  24s 256ms/step - accuracy: 0.9000 - loss: 0.1907  5/100  23s 252ms/step - accuracy: 0.9060 - loss: 0.1810  6/100  25s 267ms/step - accuracy: 0.9092 - loss: 0.1779  7/100  25s 279ms/step - accuracy: 0.9079 - loss: 0.1822  8/100  25s 278ms/step - accuracy: 0.9069 - loss: 0.1863  9/100  25s 278ms/step - accuracy: 0.9061 - loss: 0.1925 10/100  25s 281ms/step - accuracy: 0.9065 - loss: 0.1954 11/100  25s 283ms/step - accuracy: 0.9063 - loss: 0.1999 12/100  24s 282ms/step - accuracy: 0.9065 - loss: 0.2024 13/100  24s 281ms/step - accuracy: 0.9066 - loss: 0.2046 14/100  24s 281ms/step - accuracy: 0.9069 - loss: 0.2061 15/100  23s 280ms/step - accuracy: 0.9069 - loss: 0.2075 16/100  23s 280ms/step - accuracy: 0.9062 - loss: 0.2095 17/100  23s 278ms/step - accuracy: 0.9059 - loss: 0.2112 18/100  22s 280ms/step - accuracy: 0.9055 - loss: 0.2124 19/100  22s 280ms/step - accuracy: 0.9050 - loss: 0.2135 20/100  22s 279ms/step - accuracy: 0.9047 - loss: 0.2139 21/100  21s 277ms/step - accuracy: 0.9044 - loss: 0.2151 22/100  21s 275ms/step - accuracy: 0.9043 - loss: 0.2157 23/100  21s 274ms/step - accuracy: 0.9044 - loss: 0.2159 24/100  20s 272ms/step - accuracy: 0.9045 - loss: 0.2161 25/100  20s 271ms/step - accuracy: 0.9044 - loss: 0.2164 26/100  19s 270ms/step - accuracy: 0.9044 - loss: 0.2163 27/100  19s 269ms/step - accuracy: 0.9045 - loss: 0.2165 28/100  19s 267ms/step - accuracy: 0.9046 - loss: 0.2165 29/100  18s 267ms/step - accuracy: 0.9046 - loss: 0.2165 30/100  18s 266ms/step - accuracy: 0.9048 - loss: 0.2165 31/100  18s 265ms/step - accuracy: 0.9049 - loss: 0.2164 32/100  17s 264ms/step - accuracy: 0.9051 - loss: 0.2164 33/100  17s 263ms/step - accuracy: 0.9052 - loss: 0.2165 34/100  17s 262ms/step - accuracy: 0.9053 - loss: 0.2165 35/100  17s 262ms/step - accuracy: 0.9055 - loss: 0.2164 36/100  16s 261ms/step - accuracy: 0.9056 - loss: 0.2163 37/100  16s 260ms/step - accuracy: 0.9058 - loss: 0.2161 38/100  16s 260ms/step - accuracy: 0.9059 - loss: 0.2160 39/100  15s 259ms/step - accuracy: 0.9060 - loss: 0.2158 40/100  15s 259ms/step - accuracy: 0.9060 - loss: 0.2158 41/100  15s 258ms/step - accuracy: 0.9060 - loss: 0.2158 42/100  14s 258ms/step - accuracy: 0.9060 - loss: 0.2159 43/100  14s 257ms/step - accuracy: 0.9060 - loss: 0.2158 44/100  14s 257ms/step - accuracy: 0.9060 - loss: 0.2157 45/100  14s 256ms/step - accuracy: 0.9061 - loss: 0.2157 46/100  13s 256ms/step - accuracy: 0.9061 - loss: 0.2155 47/100  13s 256ms/step - accuracy: 0.9063 - loss: 0.2153 48/100  13s 255ms/step - accuracy: 0.9064 - loss: 0.2150 49/100  12s 255ms/step - accuracy: 0.9064 - loss: 0.2150 50/100  12s 254ms/step - accuracy: 0.9065 - loss: 0.2149 51/100  12s 254ms/step - accuracy: 0.9066 - loss: 0.2148 52/100  12s 254ms/step - accuracy: 0.9067 - loss: 0.2147 53/100  11s 254ms/step - accuracy: 0.9068 - loss: 0.2145 54/100  11s 253ms/step - accuracy: 0.9069 - loss: 0.2143 55/100  11s 253ms/step - accuracy: 0.9071 - loss: 0.2141 56/100  11s 253ms/step - accuracy: 0.9072 - loss: 0.2139 57/100  10s 253ms/step - accuracy: 0.9073 - loss: 0.2137 58/100  10s 252ms/step - accuracy: 0.9074 - loss: 0.2136 59/100  10s 252ms/step - accuracy: 0.9076 - loss: 0.2133 60/100  10s 252ms/step - accuracy: 0.9077 - loss: 0.2131 61/100  9s 252ms/step - accuracy: 0.9079 - loss: 0.2128  62/100  9s 251ms/step - accuracy: 0.9080 - loss: 0.2125 63/100  9s 251ms/step - accuracy: 0.9082 - loss: 0.2123 64/100  9s 251ms/step - accuracy: 0.9083 - loss: 0.2120 65/100  8s 251ms/step - accuracy: 0.9085 - loss: 0.2117 66/100  8s 251ms/step - accuracy: 0.9086 - loss: 0.2114 67/100  8s 250ms/step - accuracy: 0.9088 - loss: 0.2111 68/100  8s 250ms/step - accuracy: 0.9089 - loss: 0.2107 69/100  7s 250ms/step - accuracy: 0.9091 - loss: 0.2104 70/100  7s 250ms/step - accuracy: 0.9093 - loss: 0.2101 71/100  7s 250ms/step - accuracy: 0.9094 - loss: 0.2097 72/100  6s 250ms/step - accuracy: 0.9096 - loss: 0.2094 73/100  6s 249ms/step - accuracy: 0.9097 - loss: 0.2091 74/100  6s 249ms/step - accuracy: 0.9099 - loss: 0.2088 75/100  6s 249ms/step - accuracy: 0.9100 - loss: 0.2085 76/100  5s 249ms/step - accuracy: 0.9101 - loss: 0.2083 77/100  5s 249ms/step - accuracy: 0.9103 - loss: 0.2080 78/100  5s 249ms/step - accuracy: 0.9104 - loss: 0.2077 79/100  5s 248ms/step - accuracy: 0.9105 - loss: 0.2074 80/100  4s 248ms/step - accuracy: 0.9107 - loss: 0.2071 81/100  4s 248ms/step - accuracy: 0.9108 - loss: 0.2069 82/100  4s 248ms/step - accuracy: 0.9109 - loss: 0.2066 83/100  4s 248ms/step - accuracy: 0.9111 - loss: 0.2063 84/100  3s 248ms/step - accuracy: 0.9112 - loss: 0.2060 85/100  3s 247ms/step - accuracy: 0.9113 - loss: 0.2057 86/100  3s 247ms/step - accuracy: 0.9114 - loss: 0.2055 87/100  3s 247ms/step - accuracy: 0.9115 - loss: 0.2052 88/100  2s 247ms/step - accuracy: 0.9117 - loss: 0.2050 89/100  2s 247ms/step - accuracy: 0.9118 - loss: 0.2047 90/100  2s 247ms/step - accuracy: 0.9119 - loss: 0.2044 91/100  2s 247ms/step - accuracy: 0.9120 - loss: 0.2042 92/100  1s 246ms/step - accuracy: 0.9121 - loss: 0.2039 93/100  1s 246ms/step - accuracy: 0.9122 - loss: 0.2037 94/100  1s 246ms/step - accuracy: 0.9124 - loss: 0.2034 95/100  1s 246ms/step - accuracy: 0.9125 - loss: 0.2031 96/100  0s 246ms/step - accuracy: 0.9126 - loss: 0.2029 97/100  0s 246ms/step - accuracy: 0.9127 - loss: 0.2027 98/100  0s 246ms/step - accuracy: 0.9129 - loss: 0.2024 99/100  0s 246ms/step - accuracy: 0.9130 - loss: 0.2022100/100  0s 246ms/step - accuracy: 0.9131 - loss: 0.2020100/100  32s 322ms/step - accuracy: 0.9132 - loss: 0.2019 - val_accuracy: 0.9650 - val_loss: 0.1167
Epoch 8/10
  1/100  34s 352ms/step - accuracy: 0.8000 - loss: 0.2948  2/100  24s 251ms/step - accuracy: 0.8500 - loss: 0.2281  3/100  23s 242ms/step - accuracy: 0.8722 - loss: 0.1948  4/100  23s 243ms/step - accuracy: 0.8854 - loss: 0.1758  5/100  22s 240ms/step - accuracy: 0.8943 - loss: 0.1654  6/100  22s 240ms/step - accuracy: 0.9008 - loss: 0.1623  7/100  22s 239ms/step - accuracy: 0.9048 - loss: 0.1603  8/100  22s 243ms/step - accuracy: 0.9073 - loss: 0.1605  9/100  22s 244ms/step - accuracy: 0.9077 - loss: 0.1638 10/100  21s 244ms/step - accuracy: 0.9085 - loss: 0.1665 11/100  21s 246ms/step - accuracy: 0.9089 - loss: 0.1701 12/100  21s 245ms/step - accuracy: 0.9092 - loss: 0.1747 13/100  21s 247ms/step - accuracy: 0.9097 - loss: 0.1785 14/100  21s 246ms/step - accuracy: 0.9098 - loss: 0.1821 15/100  20s 245ms/step - accuracy: 0.9102 - loss: 0.1843 16/100  20s 245ms/step - accuracy: 0.9108 - loss: 0.1856 17/100  20s 245ms/step - accuracy: 0.9112 - loss: 0.1872 18/100  20s 245ms/step - accuracy: 0.9113 - loss: 0.1889 19/100  19s 245ms/step - accuracy: 0.9116 - loss: 0.1902 20/100  19s 247ms/step - accuracy: 0.9117 - loss: 0.1915 21/100  19s 248ms/step - accuracy: 0.9119 - loss: 0.1925 22/100  19s 247ms/step - accuracy: 0.9120 - loss: 0.1935 23/100  19s 247ms/step - accuracy: 0.9122 - loss: 0.1943 24/100  18s 248ms/step - accuracy: 0.9123 - loss: 0.1951 25/100  18s 247ms/step - accuracy: 0.9123 - loss: 0.1961 26/100  18s 247ms/step - accuracy: 0.9123 - loss: 0.1970 27/100  17s 246ms/step - accuracy: 0.9124 - loss: 0.1976 28/100  17s 246ms/step - accuracy: 0.9125 - loss: 0.1981 29/100  17s 246ms/step - accuracy: 0.9126 - loss: 0.1988 30/100  17s 246ms/step - accuracy: 0.9125 - loss: 0.1995 31/100  16s 246ms/step - accuracy: 0.9126 - loss: 0.2001 32/100  16s 246ms/step - accuracy: 0.9125 - loss: 0.2009 33/100  16s 246ms/step - accuracy: 0.9125 - loss: 0.2017 34/100  16s 247ms/step - accuracy: 0.9124 - loss: 0.2024 35/100  16s 247ms/step - accuracy: 0.9123 - loss: 0.2031 36/100  15s 247ms/step - accuracy: 0.9122 - loss: 0.2037 37/100  15s 249ms/step - accuracy: 0.9122 - loss: 0.2041 38/100  15s 253ms/step - accuracy: 0.9121 - loss: 0.2046 39/100  15s 254ms/step - accuracy: 0.9120 - loss: 0.2049 40/100  15s 254ms/step - accuracy: 0.9119 - loss: 0.2054 41/100  14s 254ms/step - accuracy: 0.9119 - loss: 0.2057 42/100  14s 254ms/step - accuracy: 0.9118 - loss: 0.2060 43/100  14s 254ms/step - accuracy: 0.9118 - loss: 0.2062 44/100  14s 253ms/step - accuracy: 0.9118 - loss: 0.2063 45/100  13s 254ms/step - accuracy: 0.9118 - loss: 0.2066 46/100  13s 254ms/step - accuracy: 0.9118 - loss: 0.2068 47/100  13s 254ms/step - accuracy: 0.9118 - loss: 0.2070 48/100  13s 254ms/step - accuracy: 0.9118 - loss: 0.2072 49/100  12s 254ms/step - accuracy: 0.9118 - loss: 0.2073 50/100  12s 254ms/step - accuracy: 0.9119 - loss: 0.2073 51/100  12s 254ms/step - accuracy: 0.9119 - loss: 0.2074 52/100  12s 254ms/step - accuracy: 0.9119 - loss: 0.2075 53/100  11s 253ms/step - accuracy: 0.9120 - loss: 0.2075 54/100  11s 253ms/step - accuracy: 0.9120 - loss: 0.2076 55/100  11s 253ms/step - accuracy: 0.9120 - loss: 0.2077 56/100  11s 253ms/step - accuracy: 0.9120 - loss: 0.2078 57/100  10s 252ms/step - accuracy: 0.9120 - loss: 0.2079 58/100  10s 252ms/step - accuracy: 0.9121 - loss: 0.2080 59/100  10s 252ms/step - accuracy: 0.9121 - loss: 0.2081 60/100  10s 252ms/step - accuracy: 0.9122 - loss: 0.2082 61/100  9s 253ms/step - accuracy: 0.9122 - loss: 0.2082  62/100  9s 253ms/step - accuracy: 0.9123 - loss: 0.2082 63/100  9s 254ms/step - accuracy: 0.9123 - loss: 0.2082 64/100  9s 254ms/step - accuracy: 0.9124 - loss: 0.2082 65/100  8s 254ms/step - accuracy: 0.9124 - loss: 0.2082 66/100  8s 254ms/step - accuracy: 0.9125 - loss: 0.2082 67/100  8s 256ms/step - accuracy: 0.9125 - loss: 0.2081 68/100  8s 257ms/step - accuracy: 0.9126 - loss: 0.2081 69/100  7s 257ms/step - accuracy: 0.9127 - loss: 0.2080 70/100  7s 257ms/step - accuracy: 0.9127 - loss: 0.2079 71/100  7s 257ms/step - accuracy: 0.9128 - loss: 0.2078 72/100  7s 258ms/step - accuracy: 0.9129 - loss: 0.2077 73/100  6s 258ms/step - accuracy: 0.9130 - loss: 0.2075 74/100  6s 258ms/step - accuracy: 0.9131 - loss: 0.2074 75/100  6s 258ms/step - accuracy: 0.9132 - loss: 0.2072 76/100  6s 258ms/step - accuracy: 0.9132 - loss: 0.2072 77/100  5s 258ms/step - accuracy: 0.9133 - loss: 0.2071 78/100  5s 258ms/step - accuracy: 0.9134 - loss: 0.2071 79/100  5s 258ms/step - accuracy: 0.9135 - loss: 0.2070 80/100  5s 258ms/step - accuracy: 0.9135 - loss: 0.2070 81/100  4s 258ms/step - accuracy: 0.9136 - loss: 0.2070 82/100  4s 257ms/step - accuracy: 0.9136 - loss: 0.2071 83/100  4s 257ms/step - accuracy: 0.9136 - loss: 0.2071 84/100  4s 257ms/step - accuracy: 0.9137 - loss: 0.2071 85/100  3s 258ms/step - accuracy: 0.9137 - loss: 0.2071 86/100  3s 259ms/step - accuracy: 0.9138 - loss: 0.2071 87/100  3s 260ms/step - accuracy: 0.9138 - loss: 0.2071 88/100  3s 260ms/step - accuracy: 0.9139 - loss: 0.2071 89/100  2s 260ms/step - accuracy: 0.9139 - loss: 0.2072 90/100  2s 261ms/step - accuracy: 0.9140 - loss: 0.2072 91/100  2s 261ms/step - accuracy: 0.9140 - loss: 0.2072 92/100  2s 261ms/step - accuracy: 0.9141 - loss: 0.2072 93/100  1s 261ms/step - accuracy: 0.9141 - loss: 0.2072 94/100  1s 261ms/step - accuracy: 0.9142 - loss: 0.2072 95/100  1s 261ms/step - accuracy: 0.9142 - loss: 0.2071 96/100  1s 261ms/step - accuracy: 0.9143 - loss: 0.2071 97/100  0s 260ms/step - accuracy: 0.9143 - loss: 0.2071 98/100  0s 260ms/step - accuracy: 0.9144 - loss: 0.2071 99/100  0s 260ms/step - accuracy: 0.9144 - loss: 0.2070100/100  0s 260ms/step - accuracy: 0.9145 - loss: 0.2070100/100  34s 337ms/step - accuracy: 0.9145 - loss: 0.2070 - val_accuracy: 0.9610 - val_loss: 0.1131
Epoch 9/10
  1/100  31s 321ms/step - accuracy: 0.9000 - loss: 0.1581  2/100  26s 268ms/step - accuracy: 0.8875 - loss: 0.2039  3/100  24s 250ms/step - accuracy: 0.8861 - loss: 0.2339  4/100  23s 249ms/step - accuracy: 0.8802 - loss: 0.2544  5/100  23s 250ms/step - accuracy: 0.8802 - loss: 0.2589  6/100  23s 248ms/step - accuracy: 0.8835 - loss: 0.2551  7/100  22s 247ms/step - accuracy: 0.8879 - loss: 0.2485  8/100  22s 245ms/step - accuracy: 0.8902 - loss: 0.2429  9/100  22s 244ms/step - accuracy: 0.8931 - loss: 0.2362 10/100  22s 245ms/step - accuracy: 0.8958 - loss: 0.2321 11/100  21s 246ms/step - accuracy: 0.8983 - loss: 0.2284 12/100  21s 248ms/step - accuracy: 0.9008 - loss: 0.2243 13/100  21s 250ms/step - accuracy: 0.9031 - loss: 0.2209 14/100  21s 255ms/step - accuracy: 0.9055 - loss: 0.2172 15/100  21s 256ms/step - accuracy: 0.9078 - loss: 0.2133 16/100  21s 256ms/step - accuracy: 0.9098 - loss: 0.2098 17/100  21s 255ms/step - accuracy: 0.9118 - loss: 0.2063 18/100  20s 255ms/step - accuracy: 0.9136 - loss: 0.2031 19/100  20s 256ms/step - accuracy: 0.9151 - loss: 0.2004 20/100  20s 257ms/step - accuracy: 0.9164 - loss: 0.1981 21/100  20s 256ms/step - accuracy: 0.9176 - loss: 0.1957 22/100  20s 257ms/step - accuracy: 0.9187 - loss: 0.1941 23/100  19s 256ms/step - accuracy: 0.9196 - loss: 0.1927 24/100  19s 255ms/step - accuracy: 0.9203 - loss: 0.1915 25/100  19s 255ms/step - accuracy: 0.9209 - loss: 0.1907 26/100  18s 254ms/step - accuracy: 0.9214 - loss: 0.1898 27/100  18s 254ms/step - accuracy: 0.9219 - loss: 0.1888 28/100  18s 253ms/step - accuracy: 0.9224 - loss: 0.1878 29/100  17s 253ms/step - accuracy: 0.9229 - loss: 0.1868 30/100  17s 253ms/step - accuracy: 0.9233 - loss: 0.1858 31/100  17s 252ms/step - accuracy: 0.9238 - loss: 0.1848 32/100  17s 252ms/step - accuracy: 0.9241 - loss: 0.1841 33/100  16s 252ms/step - accuracy: 0.9244 - loss: 0.1834 34/100  16s 252ms/step - accuracy: 0.9246 - loss: 0.1828 35/100  16s 251ms/step - accuracy: 0.9248 - loss: 0.1823 36/100  16s 251ms/step - accuracy: 0.9251 - loss: 0.1817 37/100  15s 251ms/step - accuracy: 0.9253 - loss: 0.1812 38/100  15s 253ms/step - accuracy: 0.9255 - loss: 0.1808 39/100  15s 253ms/step - accuracy: 0.9257 - loss: 0.1804 40/100  15s 253ms/step - accuracy: 0.9259 - loss: 0.1799 41/100  14s 253ms/step - accuracy: 0.9260 - loss: 0.1797 42/100  14s 253ms/step - accuracy: 0.9262 - loss: 0.1795 43/100  14s 253ms/step - accuracy: 0.9263 - loss: 0.1793 44/100  14s 253ms/step - accuracy: 0.9264 - loss: 0.1791 45/100  13s 253ms/step - accuracy: 0.9265 - loss: 0.1788 46/100  13s 252ms/step - accuracy: 0.9266 - loss: 0.1785 47/100  13s 253ms/step - accuracy: 0.9267 - loss: 0.1783 48/100  13s 254ms/step - accuracy: 0.9268 - loss: 0.1782 49/100  12s 254ms/step - accuracy: 0.9269 - loss: 0.1779 50/100  12s 254ms/step - accuracy: 0.9270 - loss: 0.1778 51/100  12s 254ms/step - accuracy: 0.9271 - loss: 0.1776 52/100  12s 254ms/step - accuracy: 0.9272 - loss: 0.1775 53/100  11s 253ms/step - accuracy: 0.9272 - loss: 0.1774 54/100  11s 253ms/step - accuracy: 0.9272 - loss: 0.1775 55/100  11s 253ms/step - accuracy: 0.9273 - loss: 0.1776 56/100  11s 253ms/step - accuracy: 0.9273 - loss: 0.1777 57/100  10s 252ms/step - accuracy: 0.9273 - loss: 0.1779 58/100  10s 252ms/step - accuracy: 0.9272 - loss: 0.1780 59/100  10s 252ms/step - accuracy: 0.9272 - loss: 0.1782 60/100  10s 252ms/step - accuracy: 0.9272 - loss: 0.1783 61/100  9s 252ms/step - accuracy: 0.9272 - loss: 0.1785  62/100  9s 251ms/step - accuracy: 0.9272 - loss: 0.1786 63/100  9s 251ms/step - accuracy: 0.9272 - loss: 0.1787 64/100  9s 251ms/step - accuracy: 0.9272 - loss: 0.1788 65/100  8s 251ms/step - accuracy: 0.9272 - loss: 0.1788 66/100  8s 251ms/step - accuracy: 0.9272 - loss: 0.1788 67/100  8s 251ms/step - accuracy: 0.9273 - loss: 0.1789 68/100  8s 251ms/step - accuracy: 0.9273 - loss: 0.1789 69/100  7s 251ms/step - accuracy: 0.9274 - loss: 0.1789 70/100  7s 251ms/step - accuracy: 0.9274 - loss: 0.1789 71/100  7s 251ms/step - accuracy: 0.9274 - loss: 0.1789 72/100  7s 251ms/step - accuracy: 0.9274 - loss: 0.1789 73/100  6s 251ms/step - accuracy: 0.9274 - loss: 0.1790 74/100  6s 251ms/step - accuracy: 0.9274 - loss: 0.1790 75/100  6s 251ms/step - accuracy: 0.9274 - loss: 0.1790 76/100  6s 251ms/step - accuracy: 0.9274 - loss: 0.1791 77/100  5s 251ms/step - accuracy: 0.9273 - loss: 0.1793 78/100  5s 251ms/step - accuracy: 0.9273 - loss: 0.1794 79/100  5s 251ms/step - accuracy: 0.9273 - loss: 0.1796 80/100  5s 251ms/step - accuracy: 0.9273 - loss: 0.1797 81/100  4s 251ms/step - accuracy: 0.9273 - loss: 0.1799 82/100  4s 251ms/step - accuracy: 0.9273 - loss: 0.1800 83/100  4s 251ms/step - accuracy: 0.9273 - loss: 0.1801 84/100  4s 251ms/step - accuracy: 0.9273 - loss: 0.1802 85/100  3s 251ms/step - accuracy: 0.9273 - loss: 0.1803 86/100  3s 251ms/step - accuracy: 0.9272 - loss: 0.1804 87/100  3s 251ms/step - accuracy: 0.9272 - loss: 0.1805 88/100  3s 251ms/step - accuracy: 0.9272 - loss: 0.1806 89/100  2s 251ms/step - accuracy: 0.9272 - loss: 0.1806 90/100  2s 251ms/step - accuracy: 0.9272 - loss: 0.1807 91/100  2s 251ms/step - accuracy: 0.9273 - loss: 0.1807 92/100  2s 251ms/step - accuracy: 0.9273 - loss: 0.1807 93/100  1s 251ms/step - accuracy: 0.9273 - loss: 0.1807 94/100  1s 251ms/step - accuracy: 0.9273 - loss: 0.1807 95/100  1s 250ms/step - accuracy: 0.9274 - loss: 0.1806 96/100  1s 250ms/step - accuracy: 0.9274 - loss: 0.1806 97/100  0s 250ms/step - accuracy: 0.9274 - loss: 0.1806 98/100  0s 250ms/step - accuracy: 0.9275 - loss: 0.1806 99/100  0s 250ms/step - accuracy: 0.9275 - loss: 0.1806100/100  0s 250ms/step - accuracy: 0.9275 - loss: 0.1806100/100  33s 329ms/step - accuracy: 0.9276 - loss: 0.1805 - val_accuracy: 0.9540 - val_loss: 0.1467
Epoch 10/10
  1/100  28s 283ms/step - accuracy: 0.8500 - loss: 0.1539  2/100  24s 248ms/step - accuracy: 0.8875 - loss: 0.1378  3/100  23s 240ms/step - accuracy: 0.8972 - loss: 0.1321  4/100  22s 238ms/step - accuracy: 0.9073 - loss: 0.1220  5/100  22s 241ms/step - accuracy: 0.9098 - loss: 0.1227  6/100  22s 240ms/step - accuracy: 0.9137 - loss: 0.1202  7/100  22s 239ms/step - accuracy: 0.9159 - loss: 0.1196  8/100  22s 240ms/step - accuracy: 0.9178 - loss: 0.1193  9/100  21s 241ms/step - accuracy: 0.9201 - loss: 0.1180 10/100  21s 240ms/step - accuracy: 0.9221 - loss: 0.1166 11/100  21s 239ms/step - accuracy: 0.9234 - loss: 0.1178 12/100  21s 239ms/step - accuracy: 0.9242 - loss: 0.1190 13/100  20s 239ms/step - accuracy: 0.9244 - loss: 0.1223 14/100  20s 239ms/step - accuracy: 0.9247 - loss: 0.1249 15/100  20s 239ms/step - accuracy: 0.9249 - loss: 0.1282 16/100  20s 238ms/step - accuracy: 0.9253 - loss: 0.1306 17/100  19s 238ms/step - accuracy: 0.9255 - loss: 0.1330 18/100  19s 238ms/step - accuracy: 0.9258 - loss: 0.1348 19/100  19s 238ms/step - accuracy: 0.9258 - loss: 0.1372 20/100  18s 237ms/step - accuracy: 0.9257 - loss: 0.1398 21/100  18s 238ms/step - accuracy: 0.9257 - loss: 0.1418 22/100  18s 239ms/step - accuracy: 0.9255 - loss: 0.1444 23/100  18s 239ms/step - accuracy: 0.9256 - loss: 0.1465 24/100  18s 239ms/step - accuracy: 0.9254 - loss: 0.1487 25/100  18s 243ms/step - accuracy: 0.9252 - loss: 0.1505 26/100  18s 245ms/step - accuracy: 0.9252 - loss: 0.1520 27/100  17s 246ms/step - accuracy: 0.9252 - loss: 0.1532 28/100  17s 246ms/step - accuracy: 0.9252 - loss: 0.1546 29/100  17s 247ms/step - accuracy: 0.9254 - loss: 0.1557 30/100  17s 252ms/step - accuracy: 0.9255 - loss: 0.1567 31/100  17s 255ms/step - accuracy: 0.9256 - loss: 0.1576 32/100  17s 258ms/step - accuracy: 0.9257 - loss: 0.1589 33/100  17s 261ms/step - accuracy: 0.9256 - loss: 0.1604 34/100  17s 261ms/step - accuracy: 0.9255 - loss: 0.1619 35/100  16s 260ms/step - accuracy: 0.9254 - loss: 0.1631 36/100  16s 260ms/step - accuracy: 0.9255 - loss: 0.1641 37/100  16s 261ms/step - accuracy: 0.9254 - loss: 0.1652 38/100  16s 261ms/step - accuracy: 0.9254 - loss: 0.1662 39/100  15s 262ms/step - accuracy: 0.9255 - loss: 0.1670 40/100  15s 263ms/step - accuracy: 0.9255 - loss: 0.1678 41/100  15s 262ms/step - accuracy: 0.9255 - loss: 0.1685 42/100  15s 262ms/step - accuracy: 0.9255 - loss: 0.1692 43/100  14s 261ms/step - accuracy: 0.9255 - loss: 0.1698 44/100  14s 262ms/step - accuracy: 0.9254 - loss: 0.1705 45/100  14s 262ms/step - accuracy: 0.9254 - loss: 0.1712 46/100  14s 262ms/step - accuracy: 0.9253 - loss: 0.1719 47/100  13s 261ms/step - accuracy: 0.9253 - loss: 0.1724 48/100  13s 262ms/step - accuracy: 0.9252 - loss: 0.1729 49/100  13s 262ms/step - accuracy: 0.9252 - loss: 0.1734 50/100  13s 263ms/step - accuracy: 0.9251 - loss: 0.1738 51/100  12s 264ms/step - accuracy: 0.9251 - loss: 0.1742 52/100  12s 264ms/step - accuracy: 0.9251 - loss: 0.1745 53/100  12s 263ms/step - accuracy: 0.9250 - loss: 0.1748 54/100  12s 263ms/step - accuracy: 0.9250 - loss: 0.1751 55/100  11s 262ms/step - accuracy: 0.9249 - loss: 0.1753 56/100  11s 262ms/step - accuracy: 0.9249 - loss: 0.1756 57/100  11s 262ms/step - accuracy: 0.9249 - loss: 0.1759 58/100  10s 261ms/step - accuracy: 0.9248 - loss: 0.1762 59/100  10s 261ms/step - accuracy: 0.9248 - loss: 0.1765 60/100  10s 261ms/step - accuracy: 0.9248 - loss: 0.1767 61/100  10s 260ms/step - accuracy: 0.9247 - loss: 0.1769 62/100  9s 260ms/step - accuracy: 0.9247 - loss: 0.1771  63/100  9s 260ms/step - accuracy: 0.9247 - loss: 0.1773 64/100  9s 259ms/step - accuracy: 0.9246 - loss: 0.1774 65/100  9s 259ms/step - accuracy: 0.9246 - loss: 0.1776 66/100  8s 259ms/step - accuracy: 0.9246 - loss: 0.1777 67/100  8s 258ms/step - accuracy: 0.9246 - loss: 0.1779 68/100  8s 258ms/step - accuracy: 0.9245 - loss: 0.1780 69/100  7s 258ms/step - accuracy: 0.9245 - loss: 0.1782 70/100  7s 258ms/step - accuracy: 0.9245 - loss: 0.1783 71/100  7s 257ms/step - accuracy: 0.9244 - loss: 0.1785 72/100  7s 257ms/step - accuracy: 0.9243 - loss: 0.1787 73/100  6s 257ms/step - accuracy: 0.9243 - loss: 0.1789 74/100  6s 257ms/step - accuracy: 0.9242 - loss: 0.1790 75/100  6s 257ms/step - accuracy: 0.9242 - loss: 0.1792 76/100  6s 257ms/step - accuracy: 0.9241 - loss: 0.1794 77/100  5s 256ms/step - accuracy: 0.9240 - loss: 0.1796 78/100  5s 256ms/step - accuracy: 0.9240 - loss: 0.1798 79/100  5s 256ms/step - accuracy: 0.9239 - loss: 0.1800 80/100  5s 256ms/step - accuracy: 0.9239 - loss: 0.1802 81/100  4s 256ms/step - accuracy: 0.9238 - loss: 0.1804 82/100  4s 255ms/step - accuracy: 0.9238 - loss: 0.1806 83/100  4s 255ms/step - accuracy: 0.9237 - loss: 0.1808 84/100  4s 255ms/step - accuracy: 0.9237 - loss: 0.1810 85/100  3s 255ms/step - accuracy: 0.9236 - loss: 0.1811 86/100  3s 255ms/step - accuracy: 0.9236 - loss: 0.1813 87/100  3s 255ms/step - accuracy: 0.9235 - loss: 0.1814 88/100  3s 255ms/step - accuracy: 0.9235 - loss: 0.1816 89/100  2s 254ms/step - accuracy: 0.9235 - loss: 0.1817 90/100  2s 254ms/step - accuracy: 0.9234 - loss: 0.1819 91/100  2s 255ms/step - accuracy: 0.9234 - loss: 0.1820 92/100  2s 255ms/step - accuracy: 0.9234 - loss: 0.1822 93/100  1s 255ms/step - accuracy: 0.9234 - loss: 0.1823 94/100  1s 255ms/step - accuracy: 0.9234 - loss: 0.1824 95/100  1s 255ms/step - accuracy: 0.9233 - loss: 0.1825 96/100  1s 255ms/step - accuracy: 0.9233 - loss: 0.1826 97/100  0s 254ms/step - accuracy: 0.9233 - loss: 0.1827 98/100  0s 255ms/step - accuracy: 0.9233 - loss: 0.1828 99/100  0s 255ms/step - accuracy: 0.9233 - loss: 0.1829100/100  0s 254ms/step - accuracy: 0.9233 - loss: 0.1830100/100  33s 328ms/step - accuracy: 0.9232 - loss: 0.1831 - val_accuracy: 0.9430 - val_loss: 0.1433</code></pre>
</div>
</div>
</section>
<section id="training-result" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> training result</h1>
<div id="b1de13c4" class="cell" data-execution_count="29">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> history.history[<span class="st">'accuracy'</span>]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> history.history[<span class="st">'val_accuracy'</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> history.history[<span class="st">'loss'</span>]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> history.history[<span class="st">'val_loss'</span>]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(acc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="c0e86945" class="cell" data-execution_count="30">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.image <span class="im">as</span> mpimg</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training and validation accuracy per epoch</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, acc, <span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Training accuracy'</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_acc, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation accuracy'</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation accuracy'</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, loss, <span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Training Loss'</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_loss, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation Loss'</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation loss'</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c2week3_files/figure-html/cell-31-output-1.png" width="579" height="431" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c2week3_files/figure-html/cell-31-output-2.png" width="571" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="resource" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> resource:</h1>
<p>https://coursera.org/learn/convolutional-neural-networks-tensorflow/home/</p>
<p>https://github.com/https-deeplearning-ai/tensorflow-1-public/tree/main/C2</p>
<p>https://www.kaggle.com/c/dogs-vs-cats</p>


<!-- -->

</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "W3:Transfer learning"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">  error: false</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-bg: true</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-border-left: "#31BAE9"</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>Week3 Transfer Learning</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>Building models for yourself is great, and can be very powerful. But, as you've seen, you can be limited by the data you have on hand. Not everybody has access to massive datasets or the compute power that's needed to train them effectively. Transfer learning can help solve this -- where people with models trained on large datasets train them, so that you can either use them directly, or, you can use the features that they have learned and apply them to your scenario. This is Transfer learning, and you'll look into that this week!</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shutil <span class="im">import</span> copyfile</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os <span class="im">import</span> getcwd</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/31.png)</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/32.png)</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># download data</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## download big cats-and-dogs.zip and we will random split into training and validation folder</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>os. getcwd()</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'tmp'</span>):</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="st">'tmp'</span>)</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>urllib.request.urlretrieve(<span class="st">"https://download.microsoft.com/download/3/E/1/3E1C3F21-ECDB-4869-8368-6DEBA77B919F/kagglecatsanddogs_5340.zip"</span>, <span class="st">"./tmp/cats-and-dogs.zip"</span>)</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>local_zip <span class="op">=</span> <span class="st">'./tmp/cats-and-dogs.zip'</span></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>zip_ref   <span class="op">=</span> zipfile.ZipFile(local_zip, <span class="st">'r'</span>)</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>zip_ref.extractall(<span class="st">'./tmp'</span>)</span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>zip_ref.close()</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="fu"># download model Download the inception v3 weights</span></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a>urllib.request.urlretrieve(<span class="st">"https://storage.googleapis.com/mledu-datasets/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5"</span>, <span class="st">"./tmp/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5"</span>)</span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>os.remove(<span class="st">'./tmp/cats-and-dogs.zip'</span>)</span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">'./tmp/PetImages'</span>)</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a>source_path <span class="op">=</span> <span class="st">'/tmp/PetImages'</span></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>source_path_dogs <span class="op">=</span> os.path.join(source_path, <span class="st">'Dog'</span>)</span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>source_path_cats <span class="op">=</span> os.path.join(source_path, <span class="st">'Cat'</span>)</span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a><span class="co"># os.listdir returns a list containing all files under the given path</span></span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(os.listdir(source_path_dogs))<span class="sc">}</span><span class="ss"> images of dogs."</span>)</span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(os.listdir(source_path_cats))<span class="sc">}</span><span class="ss"> images of cats."</span>)</span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs'</span>):</span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs'</span>)</span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/training'</span>):</span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/training'</span>)</span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/testing'</span>): </span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/testing'</span>)</span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/training/cats'</span>):</span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/training/cats'</span>)</span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/training/dogs'</span>):</span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/training/dogs'</span>)</span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/testing/cats'</span>):</span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/testing/cats'</span>)</span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./tmp/cats-v-dogs/testing/dogs'</span>):</span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a>  os.mkdir(<span class="st">'./tmp/cats-v-dogs/testing/dogs'</span>)</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_data(SOURCE, TRAINING, TESTING, SPLIT_SIZE):</span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a><span class="co"># YOUR CODE STARTS HERE</span></span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>    all_files <span class="op">=</span> []</span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_name <span class="kw">in</span> os.listdir(SOURCE):</span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> SOURCE <span class="op">+</span> file_name</span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.getsize(file_path):</span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a>            all_files.append(file_name)</span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st"> is zero length, so ignoring'</span>.<span class="bu">format</span>(file_name))</span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a>    n_files <span class="op">=</span> <span class="bu">len</span>(all_files)</span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a>    split_point <span class="op">=</span> <span class="bu">int</span>(n_files <span class="op">*</span> SPLIT_SIZE)</span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a>    shuffled <span class="op">=</span> random.sample(all_files, n_files)</span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a>    train_set <span class="op">=</span> shuffled[:split_point]</span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a>    test_set <span class="op">=</span> shuffled[split_point:]</span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_name <span class="kw">in</span> train_set:</span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a>        copyfile(SOURCE <span class="op">+</span> file_name, TRAINING <span class="op">+</span> file_name)</span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_name <span class="kw">in</span> test_set:</span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a>        copyfile(SOURCE <span class="op">+</span> file_name, TESTING <span class="op">+</span> file_name)</span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a>split_size <span class="op">=</span> <span class="fl">.9</span></span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>CAT_SOURCE_DIR <span class="op">=</span> <span class="st">"./tmp/PetImages/Cat/"</span></span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a>TRAINING_CATS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/training/cats/"</span></span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a>TESTING_CATS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/testing/cats/"</span></span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a>DOG_SOURCE_DIR <span class="op">=</span> <span class="st">"./tmp/PetImages/Dog/"</span></span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a>TRAINING_DOGS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/training/dogs/"</span></span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a>TESTING_DOGS_DIR <span class="op">=</span> <span class="st">"./tmp/cats-v-dogs/testing/dogs/"</span></span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a>split_data(CAT_SOURCE_DIR, TRAINING_CATS_DIR, TESTING_CATS_DIR, split_size)</span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a>split_data(DOG_SOURCE_DIR, TRAINING_DOGS_DIR, TESTING_DOGS_DIR, split_size)</span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-201"><a href="#cb34-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/training/cats/'</span>)))</span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/training/dogs/'</span>)))</span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/testing/cats/'</span>)))</span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(os.listdir(<span class="st">'./tmp/cats-v-dogs/testing/dogs/'</span>)))</span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'./tmp/cats-v-dogs/training/cats/11.jpg'</span>)</span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a>im.size <span class="co"># (width,height) </span></span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-222"><a href="#cb34-222" aria-hidden="true" tabindex="-1"></a><span class="fu"># Load the data</span></span>
<span id="cb34-223"><a href="#cb34-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-226"><a href="#cb34-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-227"><a href="#cb34-227" aria-hidden="true" tabindex="-1"></a>train_dir<span class="op">=</span><span class="st">'./tmp/cats-v-dogs/training/'</span></span>
<span id="cb34-228"><a href="#cb34-228" aria-hidden="true" tabindex="-1"></a>validation_dir<span class="op">=</span><span class="st">'./tmp/cats-v-dogs/testing/'</span></span>
<span id="cb34-229"><a href="#cb34-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-230"><a href="#cb34-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-231"><a href="#cb34-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-232"><a href="#cb34-232" aria-hidden="true" tabindex="-1"></a>ImageDataGenerator: All images will be resized to 150x150 and do augmentation to aviod over fiting</span>
<span id="cb34-233"><a href="#cb34-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-236"><a href="#cb34-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-237"><a href="#cb34-237" aria-hidden="true" tabindex="-1"></a>train_datagen <span class="op">=</span> ImageDataGenerator(</span>
<span id="cb34-238"><a href="#cb34-238" aria-hidden="true" tabindex="-1"></a>      rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>,</span>
<span id="cb34-239"><a href="#cb34-239" aria-hidden="true" tabindex="-1"></a>      rotation_range<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb34-240"><a href="#cb34-240" aria-hidden="true" tabindex="-1"></a>      width_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb34-241"><a href="#cb34-241" aria-hidden="true" tabindex="-1"></a>      height_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb34-242"><a href="#cb34-242" aria-hidden="true" tabindex="-1"></a>      shear_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb34-243"><a href="#cb34-243" aria-hidden="true" tabindex="-1"></a>      zoom_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb34-244"><a href="#cb34-244" aria-hidden="true" tabindex="-1"></a>      horizontal_flip<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-245"><a href="#cb34-245" aria-hidden="true" tabindex="-1"></a>      fill_mode<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb34-246"><a href="#cb34-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-247"><a href="#cb34-247" aria-hidden="true" tabindex="-1"></a>test_datagen <span class="op">=</span> ImageDataGenerator(rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>)</span>
<span id="cb34-248"><a href="#cb34-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-249"><a href="#cb34-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-252"><a href="#cb34-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-253"><a href="#cb34-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Flow training images in batches of 20 using train_datagen generator</span></span>
<span id="cb34-254"><a href="#cb34-254" aria-hidden="true" tabindex="-1"></a>train_generator <span class="op">=</span> train_datagen.flow_from_directory(</span>
<span id="cb34-255"><a href="#cb34-255" aria-hidden="true" tabindex="-1"></a>        train_dir,  <span class="co"># This is the source directory for training images</span></span>
<span id="cb34-256"><a href="#cb34-256" aria-hidden="true" tabindex="-1"></a>        target_size<span class="op">=</span>(<span class="dv">150</span>, <span class="dv">150</span>),  <span class="co"># All images will be resized to 150x150</span></span>
<span id="cb34-257"><a href="#cb34-257" aria-hidden="true" tabindex="-1"></a>        batch_size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb34-258"><a href="#cb34-258" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Since we use binary_crossentropy loss, we need binary labels</span></span>
<span id="cb34-259"><a href="#cb34-259" aria-hidden="true" tabindex="-1"></a>        class_mode<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb34-260"><a href="#cb34-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-261"><a href="#cb34-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Flow validation images in batches of 20 using test_datagen generator</span></span>
<span id="cb34-262"><a href="#cb34-262" aria-hidden="true" tabindex="-1"></a>validation_generator <span class="op">=</span> test_datagen.flow_from_directory(</span>
<span id="cb34-263"><a href="#cb34-263" aria-hidden="true" tabindex="-1"></a>        validation_dir,</span>
<span id="cb34-264"><a href="#cb34-264" aria-hidden="true" tabindex="-1"></a>        target_size<span class="op">=</span>(<span class="dv">150</span>, <span class="dv">150</span>),</span>
<span id="cb34-265"><a href="#cb34-265" aria-hidden="true" tabindex="-1"></a>        batch_size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb34-266"><a href="#cb34-266" aria-hidden="true" tabindex="-1"></a>        class_mode<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb34-267"><a href="#cb34-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-268"><a href="#cb34-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-269"><a href="#cb34-269" aria-hidden="true" tabindex="-1"></a><span class="fu"># pre_trained_model</span></span>
<span id="cb34-270"><a href="#cb34-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-273"><a href="#cb34-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-274"><a href="#cb34-274" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the inception model  </span></span>
<span id="cb34-275"><a href="#cb34-275" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.inception_v3 <span class="im">import</span> InceptionV3</span>
<span id="cb34-276"><a href="#cb34-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-277"><a href="#cb34-277" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance of the inception model from the local pre-trained weights</span></span>
<span id="cb34-278"><a href="#cb34-278" aria-hidden="true" tabindex="-1"></a>local_weights_file <span class="op">=</span> <span class="st">'./tmp/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5'</span></span>
<span id="cb34-279"><a href="#cb34-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-280"><a href="#cb34-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-283"><a href="#cb34-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-284"><a href="#cb34-284" aria-hidden="true" tabindex="-1"></a>pre_trained_model <span class="op">=</span> InceptionV3(input_shape <span class="op">=</span> (<span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">3</span>),</span>
<span id="cb34-285"><a href="#cb34-285" aria-hidden="true" tabindex="-1"></a>                                  include_top <span class="op">=</span> <span class="va">False</span>, </span>
<span id="cb34-286"><a href="#cb34-286" aria-hidden="true" tabindex="-1"></a>                                  weights <span class="op">=</span> <span class="va">None</span>) </span>
<span id="cb34-287"><a href="#cb34-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-288"><a href="#cb34-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-289"><a href="#cb34-289" aria-hidden="true" tabindex="-1"></a>pre_trained_model.load_weights(local_weights_file)</span>
<span id="cb34-290"><a href="#cb34-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-291"><a href="#cb34-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Make all the layers in the pre-trained model non-trainable</span></span>
<span id="cb34-292"><a href="#cb34-292" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> layer <span class="kw">in</span> pre_trained_model.layers:</span>
<span id="cb34-293"><a href="#cb34-293" aria-hidden="true" tabindex="-1"></a>  layer.trainable <span class="op">=</span> <span class="va">False</span></span>
<span id="cb34-294"><a href="#cb34-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-295"><a href="#cb34-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-296"><a href="#cb34-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-297"><a href="#cb34-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-300"><a href="#cb34-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-301"><a href="#cb34-301" aria-hidden="true" tabindex="-1"></a><span class="co">#pre_trained_model.summary()</span></span>
<span id="cb34-302"><a href="#cb34-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-303"><a href="#cb34-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-306"><a href="#cb34-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-307"><a href="#cb34-307" aria-hidden="true" tabindex="-1"></a>total_params <span class="op">=</span> pre_trained_model.count_params()</span>
<span id="cb34-308"><a href="#cb34-308" aria-hidden="true" tabindex="-1"></a>num_trainable_params <span class="op">=</span> <span class="bu">sum</span>([w.shape.num_elements() <span class="cf">for</span> w <span class="kw">in</span> pre_trained_model.trainable_weights])</span>
<span id="cb34-309"><a href="#cb34-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-310"><a href="#cb34-310" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>total_params<span class="sc">:,}</span><span class="ss"> total parameters in this model."</span>)</span>
<span id="cb34-311"><a href="#cb34-311" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>num_trainable_params<span class="sc">:,}</span><span class="ss"> trainable parameters in this model."</span>)</span>
<span id="cb34-312"><a href="#cb34-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-313"><a href="#cb34-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-316"><a href="#cb34-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-317"><a href="#cb34-317" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose `mixed_7` as the last layer of your base model and not using layer after mixed7</span></span>
<span id="cb34-318"><a href="#cb34-318" aria-hidden="true" tabindex="-1"></a>last_layer <span class="op">=</span> pre_trained_model.get_layer(<span class="st">'mixed7'</span>)</span>
<span id="cb34-319"><a href="#cb34-319" aria-hidden="true" tabindex="-1"></a><span class="co">#print('last layer output shape: ', last_layer.output_shape)</span></span>
<span id="cb34-320"><a href="#cb34-320" aria-hidden="true" tabindex="-1"></a>last_output <span class="op">=</span> last_layer.output</span>
<span id="cb34-321"><a href="#cb34-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-322"><a href="#cb34-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-323"><a href="#cb34-323" aria-hidden="true" tabindex="-1"></a><span class="fu"># base model</span></span>
<span id="cb34-324"><a href="#cb34-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-325"><a href="#cb34-325" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/33.png)</span>{width="457"}</span>
<span id="cb34-326"><a href="#cb34-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-327"><a href="#cb34-327" aria-hidden="true" tabindex="-1"></a>add Dropout to improve over fitting issue.</span>
<span id="cb34-328"><a href="#cb34-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-331"><a href="#cb34-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-332"><a href="#cb34-332" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb34-333"><a href="#cb34-333" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Flatten()(last_output)</span>
<span id="cb34-334"><a href="#cb34-334" aria-hidden="true" tabindex="-1"></a> <span class="co"># Add a fully connected layer with 1024 hidden units and ReLU activation</span></span>
<span id="cb34-335"><a href="#cb34-335" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>)(x)</span>
<span id="cb34-336"><a href="#cb34-336" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a dropout rate of 0.2</span></span>
<span id="cb34-337"><a href="#cb34-337" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Dropout(<span class="fl">0.2</span>)(x)  </span>
<span id="cb34-338"><a href="#cb34-338" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a final sigmoid layer for classification</span></span>
<span id="cb34-339"><a href="#cb34-339" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'sigmoid'</span>)(x) </span>
<span id="cb34-340"><a href="#cb34-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-341"><a href="#cb34-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-342"><a href="#cb34-342" aria-hidden="true" tabindex="-1"></a>final model</span>
<span id="cb34-343"><a href="#cb34-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-346"><a href="#cb34-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-347"><a href="#cb34-347" aria-hidden="true" tabindex="-1"></a><span class="co"># Append the dense network to the base model</span></span>
<span id="cb34-348"><a href="#cb34-348" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> Model</span>
<span id="cb34-349"><a href="#cb34-349" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(pre_trained_model.<span class="bu">input</span>, x) </span>
<span id="cb34-350"><a href="#cb34-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-351"><a href="#cb34-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary. See your dense network connected at the end.</span></span>
<span id="cb34-352"><a href="#cb34-352" aria-hidden="true" tabindex="-1"></a><span class="co">#model.summary()</span></span>
<span id="cb34-353"><a href="#cb34-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-354"><a href="#cb34-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-355"><a href="#cb34-355" aria-hidden="true" tabindex="-1"></a><span class="fu"># compile model</span></span>
<span id="cb34-356"><a href="#cb34-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-359"><a href="#cb34-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-360"><a href="#cb34-360" aria-hidden="true" tabindex="-1"></a><span class="co"># v2.11+ optimizer `tf.keras.optimizers.RMSprop` runs slowly on M1/M2 Macs</span></span>
<span id="cb34-361"><a href="#cb34-361" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb34-362"><a href="#cb34-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-363"><a href="#cb34-363" aria-hidden="true" tabindex="-1"></a><span class="co">#from tensorflow.keras.optimizers.legacy import RMSprop</span></span>
<span id="cb34-364"><a href="#cb34-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-365"><a href="#cb34-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-366"><a href="#cb34-366" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'binary_crossentropy'</span>,</span>
<span id="cb34-367"><a href="#cb34-367" aria-hidden="true" tabindex="-1"></a>              optimizer<span class="op">=</span>RMSprop(learning_rate<span class="op">=</span><span class="fl">0.001</span>),</span>
<span id="cb34-368"><a href="#cb34-368" aria-hidden="true" tabindex="-1"></a>              metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb34-369"><a href="#cb34-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-370"><a href="#cb34-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-371"><a href="#cb34-371" aria-hidden="true" tabindex="-1"></a><span class="fu"># Callbacks</span></span>
<span id="cb34-372"><a href="#cb34-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-375"><a href="#cb34-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-376"><a href="#cb34-376" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> myCallback(tf.keras.callbacks.Callback):</span>
<span id="cb34-377"><a href="#cb34-377" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> on_epoch_end(<span class="va">self</span>, epoch, logs<span class="op">=</span>{}):</span>
<span id="cb34-378"><a href="#cb34-378" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(logs.get(<span class="st">'accuracy'</span>)<span class="op">&gt;</span><span class="fl">0.95</span>):</span>
<span id="cb34-379"><a href="#cb34-379" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Reached 95% accuracy so cancelling training!"</span>)</span>
<span id="cb34-380"><a href="#cb34-380" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.model.stop_training <span class="op">=</span> <span class="va">True</span></span>
<span id="cb34-381"><a href="#cb34-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-382"><a href="#cb34-382" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate class</span></span>
<span id="cb34-383"><a href="#cb34-383" aria-hidden="true" tabindex="-1"></a>callbacks <span class="op">=</span> myCallback()</span>
<span id="cb34-384"><a href="#cb34-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-385"><a href="#cb34-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-388"><a href="#cb34-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-389"><a href="#cb34-389" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the new model with augmentation</span></span>
<span id="cb34-390"><a href="#cb34-390" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb34-391"><a href="#cb34-391" aria-hidden="true" tabindex="-1"></a>      train_generator,</span>
<span id="cb34-392"><a href="#cb34-392" aria-hidden="true" tabindex="-1"></a>      steps_per_epoch<span class="op">=</span><span class="dv">100</span>,  <span class="co"># 2000 images = batch_size * steps</span></span>
<span id="cb34-393"><a href="#cb34-393" aria-hidden="true" tabindex="-1"></a>      epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb34-394"><a href="#cb34-394" aria-hidden="true" tabindex="-1"></a>      validation_data<span class="op">=</span>validation_generator,</span>
<span id="cb34-395"><a href="#cb34-395" aria-hidden="true" tabindex="-1"></a>      validation_steps<span class="op">=</span><span class="dv">50</span>,  <span class="co"># 1000 images = batch_size * steps</span></span>
<span id="cb34-396"><a href="#cb34-396" aria-hidden="true" tabindex="-1"></a>      callbacks<span class="op">=</span>[callbacks]</span>
<span id="cb34-397"><a href="#cb34-397" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-398"><a href="#cb34-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-399"><a href="#cb34-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-400"><a href="#cb34-400" aria-hidden="true" tabindex="-1"></a><span class="fu"># training result</span></span>
<span id="cb34-401"><a href="#cb34-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-404"><a href="#cb34-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-405"><a href="#cb34-405" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> history.history[<span class="st">'accuracy'</span>]</span>
<span id="cb34-406"><a href="#cb34-406" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> history.history[<span class="st">'val_accuracy'</span>]</span>
<span id="cb34-407"><a href="#cb34-407" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> history.history[<span class="st">'loss'</span>]</span>
<span id="cb34-408"><a href="#cb34-408" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> history.history[<span class="st">'val_loss'</span>]</span>
<span id="cb34-409"><a href="#cb34-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-410"><a href="#cb34-410" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(acc))</span>
<span id="cb34-411"><a href="#cb34-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-412"><a href="#cb34-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-413"><a href="#cb34-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-416"><a href="#cb34-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb34-417"><a href="#cb34-417" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.image <span class="im">as</span> mpimg</span>
<span id="cb34-418"><a href="#cb34-418" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb34-419"><a href="#cb34-419" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------</span></span>
<span id="cb34-420"><a href="#cb34-420" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training and validation accuracy per epoch</span></span>
<span id="cb34-421"><a href="#cb34-421" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------</span></span>
<span id="cb34-422"><a href="#cb34-422" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, acc, <span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Training accuracy'</span>)</span>
<span id="cb34-423"><a href="#cb34-423" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_acc, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation accuracy'</span>)</span>
<span id="cb34-424"><a href="#cb34-424" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation accuracy'</span>)</span>
<span id="cb34-425"><a href="#cb34-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-426"><a href="#cb34-426" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb34-427"><a href="#cb34-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-428"><a href="#cb34-428" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, loss, <span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Training Loss'</span>)</span>
<span id="cb34-429"><a href="#cb34-429" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_loss, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation Loss'</span>)</span>
<span id="cb34-430"><a href="#cb34-430" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation loss'</span>)</span>
<span id="cb34-431"><a href="#cb34-431" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb34-432"><a href="#cb34-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-433"><a href="#cb34-433" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb34-434"><a href="#cb34-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-435"><a href="#cb34-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-436"><a href="#cb34-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-437"><a href="#cb34-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-438"><a href="#cb34-438" aria-hidden="true" tabindex="-1"></a><span class="fu"># resource:</span></span>
<span id="cb34-439"><a href="#cb34-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-440"><a href="#cb34-440" aria-hidden="true" tabindex="-1"></a>https://coursera.org/learn/convolutional-neural-networks-tensorflow/home/</span>
<span id="cb34-441"><a href="#cb34-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-442"><a href="#cb34-442" aria-hidden="true" tabindex="-1"></a>https://github.com/https-deeplearning-ai/tensorflow-1-public/tree/main/C2</span>
<span id="cb34-443"><a href="#cb34-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-444"><a href="#cb34-444" aria-hidden="true" tabindex="-1"></a>https://www.kaggle.com/c/dogs-vs-cats</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This website is built with  and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>